"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{9320:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(7437);function l(e){let{isOpen:t,title:n,onClose:l,children:o}=e;return t?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-slate-900/40",onClick:l,role:"presentation"}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-lg rounded-xl bg-white p-6 shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[n?(0,r.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:n}):null,(0,r.jsx)("button",{type:"button",onClick:l,className:"text-sm text-slate-500 hover:text-slate-700",children:"ปิด"})]}),(0,r.jsx)("div",{className:"mt-4",children:o})]})]}):null}},3442:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(7437),l=n(2265),o=n(9320);function a(e){let{open:t,onOpenChange:n,job:a,onJobUpdate:s}=e,[i,u]=(0,l.useState)(""),[c,d]=(0,l.useState)(""),[m,p]=(0,l.useState)(""),[h,f]=(0,l.useState)({}),[x,b]=(0,l.useState)(!1),[y,g]=(0,l.useState)(null);(0,l.useEffect)(()=>{var e,n,r;t&&(u(null!==(e=null==a?void 0:a.notice_date)&&void 0!==e?e:""),d(null!==(n=null==a?void 0:a.notice_by)&&void 0!==n?n:""),p(null!==(r=null==a?void 0:a.mymaps_url)&&void 0!==r?r:""),f({}),g(null),b(!1))},[t,a]),(0,l.useEffect)(()=>{if(!y)return;let e=window.setTimeout(()=>{g(null)},2e3);return()=>window.clearTimeout(e)},[y]);let v=async()=>{if(!a)return;let e={},t=m.trim();if(i||(e.noticeDate="กรุณาระบุวันที่จะไปดำเนินการแจ้ง"),c.trim()||(e.noticeBy="กรุณาระบุผู้แจ้ง"),t){let n=/^https?:\/\//i.test(t)?t:"https://".concat(t);try{let e=new URL(n);if("http:"!==e.protocol&&"https:"!==e.protocol)throw Error("invalid protocol")}catch(t){e.mymapsUrl="ลิ้งไม่ถูกต้อง"}}else e.mymapsUrl="กรุณาระบุลิ้ง my map";if(Object.keys(e).length>0){f(e);return}b(!0),f({});try{var r,l;let e=/^https?:\/\//i.test(t)?t:"https://".concat(t),o={jobId:a.id,notice_date:i,notice_by:c.trim(),mymaps_url:e},u=await fetch("/api/jobs/notice-schedule",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),d=await u.json().catch(()=>null);if(!u.ok||!(null==d?void 0:d.ok))throw Error(null!==(r=null==d?void 0:d.error)&&void 0!==r?r:"ไม่สามารถบันทึกกำหนดการได้");let m=null!==(l=d.notice_scheduled_at)&&void 0!==l?l:new Date().toISOString();null==s||s(a.id,{notice_status:"SCHEDULED",notice_date:o.notice_date,notice_by:o.notice_by,mymaps_url:o.mymaps_url,notice_scheduled_at:m}),g("กำหนดการแจ้งเรียบร้อยแล้ว"),setTimeout(()=>{n(!1)},800)}catch(e){console.error("Notice schedule failed",e),f({submit:"บันทึกกำหนดการไม่สำเร็จ กรุณาลองใหม่"})}finally{b(!1)}};return(0,r.jsx)(o.Z,{isOpen:t,title:"แจ้งหนังสือดับไฟ",onClose:()=>n(!1),children:(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[y?(0,r.jsx)("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:y}):null,(0,r.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["วันที่จะไปดำเนินการแจ้ง",(0,r.jsx)("input",{type:"date",value:i,onChange:e=>u(e.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0}),h.noticeDate?(0,r.jsx)("span",{className:"text-xs text-red-600",children:h.noticeDate}):null]}),(0,r.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["ผู้แจ้ง",(0,r.jsx)("input",{type:"text",value:c,onChange:e=>d(e.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0}),h.noticeBy?(0,r.jsx)("span",{className:"text-xs text-red-600",children:h.noticeBy}):null]}),(0,r.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["ลิ้ง my map",(0,r.jsx)("input",{type:"url",value:m,onChange:e=>p(e.target.value),placeholder:"https://",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0}),h.mymapsUrl?(0,r.jsx)("span",{className:"text-xs text-red-600",children:h.mymapsUrl}):null]}),h.submit?(0,r.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:h.submit}):null,(0,r.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>n(!1),className:"rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100",children:"ยกเลิก"}),(0,r.jsx)("button",{type:"button",onClick:v,disabled:x,className:"rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:x?"กำลังบันทึก...":"บันทึกกำหนดการ"})]})]})})}},6600:function(e,t,n){n.d(t,{Z:function(){return b}});var r=n(7437),l=n(2265);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),a=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),s=e=>{let t=a(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},u=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,l.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:a,className:s="",children:d,iconNode:m,...p}=e;return(0,l.createElement)("svg",{ref:t,...c,width:r,height:r,stroke:n,strokeWidth:a?24*Number(o)/Number(r):o,className:i("lucide",s),...!d&&!u(p)&&{"aria-hidden":"true"},...p},[...m.map(e=>{let[t,n]=e;return(0,l.createElement)(t,n)}),...Array.isArray(d)?d:[d]])}),m=(e,t)=>{let n=(0,l.forwardRef)((n,r)=>{let{className:a,...u}=n;return(0,l.createElement)(d,{ref:r,iconNode:t,className:i("lucide-".concat(o(s(e))),"lucide-".concat(e),a),...u})});return n.displayName=s(e),n},p=m("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),h=m("route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),f=e=>{let t=null==e?void 0:e.trim();if(!t)return null;let n=/^https?:\/\//i.test(t)?t:"https://".concat(t);try{let e=new URL(n);if("http:"!==e.protocol&&"https:"!==e.protocol)return null;return e.toString()}catch(e){return null}},x=e=>{e.stopPropagation()};function b(e){let{googleUrl:t,myMapUrl:n,className:l=""}=e,o=f(t),a=f(n);if(!o&&!a)return null;let s="h-4 w-4 text-purple-600",i="".concat("flex items-center justify-center gap-2 w-full md:w-auto rounded-2xl md:rounded-xl py-3 md:py-2 px-4 md:px-3 text-sm md:text-xs font-semibold md:font-medium transition-all duration-200 ease-out active:scale-[0.97] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2 relative z-10 select-none","\n  bg-white\n  border border-purple-200/80\n  shadow-sm md:shadow-none\n  hover:bg-purple-50/60 hover:border-purple-300/80\n"),u=!!(o&&a),c=(e,t,n,l)=>(0,r.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",onClick:x,onPointerDownCapture:x,className:i,children:[n,(0,r.jsx)("span",{className:"bg-gradient-to-r from-purple-700 via-violet-700 to-indigo-700 bg-clip-text text-transparent",children:t})]});return(0,r.jsxs)("div",{className:"".concat(u?"grid grid-cols-2 gap-2 mt-2 md:mt-1 md:justify-items-start":"mt-2 md:mt-1").concat(l?" ".concat(l):""),children:[o?c(o,"Google Map",(0,r.jsx)(p,{className:s,"aria-hidden":"true"}),!0):null,a?c(a,"My Map",(0,r.jsx)(h,{className:s,"aria-hidden":"true"}),!o):null]})}},1707:function(e,t,n){n.d(t,{Cq:function(){return a},DQ:function(){return l},Z6:function(){return i},Zn:function(){return o},gK:function(){return s},uA:function(){return u}});var r=n(3866);async function l(){return r.O.from("outage_jobs").select("*").order("outage_date",{ascending:!0})}async function o(e){return r.O.from("outage_jobs").select("*").eq("id",e).single()}async function a(e){var t;return r.O.from("outage_jobs").insert({outage_date:e.outage_date,equipment_code:e.equipment_code,note:null!==(t=e.note)&&void 0!==t?t:null})}async function s(e,t){var n;return r.O.from("outage_jobs").update({outage_date:t.outage_date,equipment_code:t.equipment_code,note:null!==(n=t.note)&&void 0!==n?n:null}).eq("id",e)}async function i(e,t){return r.O.from("outage_jobs").update({nakhon_status:"NOTIFIED",nakhon_notified_date:t.date,nakhon_memo_no:t.memoNo}).eq("id",e)}async function u(e){return r.O.from("outage_jobs").update({nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}).eq("id",e)}},3866:function(e,t,n){n.d(t,{O:function(){return r}});let r=(0,n(2157).e)()},2157:function(e,t,n){n.d(t,{X:function(){return d},e:function(){return c}});var r=n(7327);n(357);let l="https://yhkrzepnokhiqbxwhkgz.supabase.co",o="sb_publishable_CdTtNwP3k39LxhkLkKbS3w_Y3co_tFE",a=null,s=!1,i=()=>{if(!l||!o)throw Error("Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.")},u=async(e,t)=>{e&&t?await fetch("/api/auth/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:e,refreshToken:t})}):await fetch("/api/auth/session",{method:"DELETE"})},c=()=>(i(),a||(a=(0,r.eI)(l,o)),s||(s=!0,a.auth.onAuthStateChange((e,t)=>{var n,r;u(null!==(n=null==t?void 0:t.access_token)&&void 0!==n?n:null,null!==(r=null==t?void 0:t.refresh_token)&&void 0!==r?r:null)})),a),d=async e=>{await u(e.access_token,e.refresh_token)}}}]);