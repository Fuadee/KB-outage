(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[534],{8038:function(e,t,n){Promise.resolve().then(n.bind(n,7350))},6463:function(e,t,n){"use strict";var s=n(1169);n.o(s,"useParams")&&n.d(t,{useParams:function(){return s.useParams}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})},7350:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var s=n(7437),r=n(2265),a=n(6463),o=n(7138),u=n(9584);function l(){let e=(0,a.useRouter)(),t=(0,a.useParams)(),[n,l]=(0,r.useState)(""),[d,i]=(0,r.useState)(""),[c,m]=(0,r.useState)(""),[x,f]=(0,r.useState)(!0),[b,p]=(0,r.useState)(!1),[h,_]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{var e,n;if(!t.id)return;f(!0),_(null);let{data:s,error:r}=await (0,u.Zn)(t.id);if(r||!s){_(null!==(e=null==r?void 0:r.message)&&void 0!==e?e:"ไม่พบงานที่ต้องการ"),f(!1);return}l(s.outage_date),i(s.equipment_code),m(null!==(n=s.note)&&void 0!==n?n:""),f(!1)})()},[t.id]);let g=async s=>{if(s.preventDefault(),!t.id)return;if(_(null),!n||!d.trim()){_("กรุณากรอกวันที่และรหัสอุปกรณ์");return}p(!0);let{error:r}=await (0,u.gK)(t.id,{outage_date:n,equipment_code:d.trim(),note:c.trim()?c.trim():null});if(r){_(r.message),p(!1);return}p(!1),e.push("/")},v=async()=>{if(!t.id)return;p(!0),_(null);let{error:n}=await (0,u.CC)(t.id);if(n){_(n.message),p(!1);return}e.push("/")};return x?(0,s.jsx)("div",{className:"rounded-2xl border border-slate-200 bg-white px-4 py-8 text-center text-sm text-slate-500 shadow-sm",children:"กำลังโหลดข้อมูล..."}):(0,s.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,s.jsxs)("header",{className:"flex flex-col gap-2",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"แก้ไขงาน"}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"ปรับปรุงรายละเอียดหรือลบงานนี้ออกจากระบบ"})]}),(0,s.jsxs)("form",{onSubmit:g,className:"flex flex-col gap-6 rounded-2xl bg-white p-6 shadow-sm",children:[(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["วันที่ดับไฟ",(0,s.jsx)("input",{type:"date",value:n,onChange:e=>l(e.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0})]}),(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["รหัสอุปกรณ์",(0,s.jsx)("input",{type:"text",value:d,onChange:e=>i(e.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0})]}),(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["หมายเหตุเพิ่มเติม",(0,s.jsx)("textarea",{value:c,onChange:e=>m(e.target.value),rows:4,className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400"})]}),h?(0,s.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:h}):null,(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsx)("button",{type:"submit",disabled:b,className:"rounded-xl bg-slate-900 px-5 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:b?"กำลังบันทึก...":"บันทึก"}),(0,s.jsx)("button",{type:"button",onClick:v,disabled:b,className:"rounded-xl border border-red-200 px-5 py-2 text-sm font-medium text-red-600 shadow-sm transition hover:bg-red-50 disabled:cursor-not-allowed disabled:opacity-70",children:"ลบงาน"}),(0,s.jsx)(o.default,{href:"/",className:"rounded-xl border border-slate-200 px-5 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100",children:"กลับ"})]})]})]})}},9584:function(e,t,n){"use strict";n.d(t,{Cq:function(){return d},CC:function(){return c},Zn:function(){return l},DQ:function(){return u},uA:function(){return x},Z6:function(){return m},gK:function(){return i}});var s=n(7327);let r="https://yhkrzepnokhiqbxwhkgz.supabase.co",a="sb_publishable_CdTtNwP3k39LxhkLkKbS3w_Y3co_tFE";if(!r||!a)throw Error("Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.");let o=(0,s.eI)(r,a);async function u(){return o.from("outage_jobs").select("*").order("outage_date",{ascending:!0})}async function l(e){return o.from("outage_jobs").select("*").eq("id",e).single()}async function d(e){var t;return o.from("outage_jobs").insert({outage_date:e.outage_date,equipment_code:e.equipment_code,note:null!==(t=e.note)&&void 0!==t?t:null})}async function i(e,t){var n;return o.from("outage_jobs").update({outage_date:t.outage_date,equipment_code:t.equipment_code,note:null!==(n=t.note)&&void 0!==n?n:null}).eq("id",e)}async function c(e){return o.from("outage_jobs").delete().eq("id",e)}async function m(e,t){return o.from("outage_jobs").update({nakhon_status:"NOTIFIED",nakhon_notified_date:t.date,nakhon_memo_no:t.memoNo}).eq("id",e)}async function x(e){return o.from("outage_jobs").update({nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}).eq("id",e)}}},function(e){e.O(0,[705,971,23,744],function(){return e(e.s=8038)}),_N_E=e.O()}]);