(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[453],{1056:function(e,t,n){Promise.resolve().then(n.bind(n,7152))},7152:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return u}});var a=n(7437),s=n(2265),o=n(6463),r=n(7138),l=n(1707);function u(){let e=(0,o.useRouter)(),[t,n]=(0,s.useState)(""),[u,i]=(0,s.useState)(""),[d,c]=(0,s.useState)(""),[f,m]=(0,s.useState)(!1),[x,h]=(0,s.useState)(null),p=async n=>{if(n.preventDefault(),h(null),!t||!u.trim()){h("กรุณากรอกวันที่และรหัสอุปกรณ์");return}m(!0);let{error:a}=await (0,l.Cq)({outage_date:t,equipment_code:u.trim(),note:d.trim()?d.trim():null});if(a){h(a.message),m(!1);return}e.push("/")};return(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"สร้างงานใหม่"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"ระบุรายละเอียดสำหรับงานดับไฟที่จะมาถึง"})]}),(0,a.jsxs)("form",{onSubmit:p,className:"flex flex-col gap-6 rounded-2xl bg-white p-6 shadow-sm",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["วันที่ดับไฟ",(0,a.jsx)("input",{type:"date",value:t,onChange:e=>n(e.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["รหัสอุปกรณ์",(0,a.jsx)("input",{type:"text",value:u,onChange:e=>i(e.target.value),placeholder:"เช่น TR-001",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["หมายเหตุเพิ่มเติม",(0,a.jsx)("textarea",{value:d,onChange:e=>c(e.target.value),rows:4,placeholder:"กรอกรายละเอียดเพิ่มเติม (ถ้ามี)",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400"})]}),x?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:x}):null,(0,a.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,a.jsx)("button",{type:"submit",disabled:f,className:"rounded-xl bg-slate-900 px-5 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:f?"กำลังบันทึก...":"บันทึก"}),(0,a.jsx)(r.default,{href:"/",className:"rounded-xl border border-slate-200 px-5 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100",children:"ยกเลิก"})]})]})]})}},1707:function(e,t,n){"use strict";n.d(t,{Cq:function(){return r},DQ:function(){return s},Z6:function(){return u},Zn:function(){return o},gK:function(){return l},uA:function(){return i}});var a=n(3866);async function s(){return a.O.from("outage_jobs").select("*").order("outage_date",{ascending:!0})}async function o(e){return a.O.from("outage_jobs").select("*").eq("id",e).single()}async function r(e){var t;return a.O.from("outage_jobs").insert({outage_date:e.outage_date,equipment_code:e.equipment_code,note:null!==(t=e.note)&&void 0!==t?t:null})}async function l(e,t){var n;return a.O.from("outage_jobs").update({outage_date:t.outage_date,equipment_code:t.equipment_code,note:null!==(n=t.note)&&void 0!==n?n:null}).eq("id",e)}async function u(e,t){return a.O.from("outage_jobs").update({nakhon_status:"NOTIFIED",nakhon_notified_date:t.date,nakhon_memo_no:t.memoNo}).eq("id",e)}async function i(e){return a.O.from("outage_jobs").update({nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}).eq("id",e)}},3866:function(e,t,n){"use strict";n.d(t,{O:function(){return a}});let a=(0,n(2157).e)()},2157:function(e,t,n){"use strict";n.d(t,{X:function(){return c},e:function(){return d}});var a=n(7327);n(357);let s="https://yhkrzepnokhiqbxwhkgz.supabase.co",o="sb_publishable_CdTtNwP3k39LxhkLkKbS3w_Y3co_tFE",r=null,l=!1,u=()=>{if(!s||!o)throw Error("Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.")},i=async(e,t)=>{e&&t?await fetch("/api/auth/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:e,refreshToken:t})}):await fetch("/api/auth/session",{method:"DELETE"})},d=()=>(u(),r||(r=(0,a.eI)(s,o)),l||(l=!0,r.auth.onAuthStateChange((e,t)=>{var n,a;i(null!==(n=null==t?void 0:t.access_token)&&void 0!==n?n:null,null!==(a=null==t?void 0:t.refresh_token)&&void 0!==a?a:null)})),r),c=async e=>{await i(e.access_token,e.refresh_token)}}},function(e){e.O(0,[200,138,971,23,744],function(){return e(e.s=1056)}),_N_E=e.O()}]);