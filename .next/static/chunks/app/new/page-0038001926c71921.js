(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[453],{1056:function(e,t,n){Promise.resolve().then(n.bind(n,7152))},6463:function(e,t,n){"use strict";var s=n(1169);n.o(s,"useParams")&&n.d(t,{useParams:function(){return s.useParams}}),n.o(s,"useRouter")&&n.d(t,{useRouter:function(){return s.useRouter}})},7152:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var s=n(7437),a=n(2265),o=n(6463),r=n(7138),u=n(9584);function l(){let e=(0,o.useRouter)(),[t,n]=(0,a.useState)(""),[l,d]=(0,a.useState)(""),[i,c]=(0,a.useState)(""),[m,f]=(0,a.useState)(!1),[x,h]=(0,a.useState)(null),p=async n=>{if(n.preventDefault(),h(null),!t||!l.trim()){h("กรุณากรอกวันที่และรหัสอุปกรณ์");return}f(!0);let{error:s}=await (0,u.Cq)({outage_date:t,equipment_code:l.trim(),note:i.trim()?i.trim():null});if(s){h(s.message),f(!1);return}e.push("/")};return(0,s.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,s.jsxs)("header",{className:"flex flex-col gap-2",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"สร้างงานใหม่"}),(0,s.jsx)("p",{className:"text-sm text-slate-500",children:"ระบุรายละเอียดสำหรับงานดับไฟที่จะมาถึง"})]}),(0,s.jsxs)("form",{onSubmit:p,className:"flex flex-col gap-6 rounded-2xl bg-white p-6 shadow-sm",children:[(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["วันที่ดับไฟ",(0,s.jsx)("input",{type:"date",value:t,onChange:e=>n(e.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0})]}),(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["รหัสอุปกรณ์",(0,s.jsx)("input",{type:"text",value:l,onChange:e=>d(e.target.value),placeholder:"เช่น TR-001",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0})]}),(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["หมายเหตุเพิ่มเติม",(0,s.jsx)("textarea",{value:i,onChange:e=>c(e.target.value),rows:4,placeholder:"กรอกรายละเอียดเพิ่มเติม (ถ้ามี)",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400"})]}),x?(0,s.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:x}):null,(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsx)("button",{type:"submit",disabled:m,className:"rounded-xl bg-slate-900 px-5 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:m?"กำลังบันทึก...":"บันทึก"}),(0,s.jsx)(r.default,{href:"/",className:"rounded-xl border border-slate-200 px-5 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100",children:"ยกเลิก"})]})]})]})}},9584:function(e,t,n){"use strict";n.d(t,{Cq:function(){return d},CC:function(){return c},Zn:function(){return l},DQ:function(){return u},uA:function(){return f},Z6:function(){return m},gK:function(){return i}});var s=n(7327);let a="https://yhkrzepnokhiqbxwhkgz.supabase.co",o="sb_publishable_CdTtNwP3k39LxhkLkKbS3w_Y3co_tFE";if(!a||!o)throw Error("Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.");let r=(0,s.eI)(a,o);async function u(){return r.from("outage_jobs").select("*").order("outage_date",{ascending:!0})}async function l(e){return r.from("outage_jobs").select("*").eq("id",e).single()}async function d(e){var t;return r.from("outage_jobs").insert({outage_date:e.outage_date,equipment_code:e.equipment_code,note:null!==(t=e.note)&&void 0!==t?t:null})}async function i(e,t){var n;return r.from("outage_jobs").update({outage_date:t.outage_date,equipment_code:t.equipment_code,note:null!==(n=t.note)&&void 0!==n?n:null}).eq("id",e)}async function c(e){return r.from("outage_jobs").delete().eq("id",e)}async function m(e,t){return r.from("outage_jobs").update({nakhon_status:"NOTIFIED",nakhon_notified_date:t.date,nakhon_memo_no:t.memoNo}).eq("id",e)}async function f(e){return r.from("outage_jobs").update({nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}).eq("id",e)}}},function(e){e.O(0,[705,971,23,744],function(){return e(e.s=1056)}),_N_E=e.O()}]);