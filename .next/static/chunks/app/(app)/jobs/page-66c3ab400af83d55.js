(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[853],{10:function(e,t,l){Promise.resolve().then(l.bind(l,2439))},2439:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return S}});var a=l(7437),s=l(6463),n=l(2265),o=l(6600),i=l(9320),r=l(3442),d=l(6760);function c(e){return new Date("".concat(e,"T00:00:00"))}function u(e){let t=new Date(e);return t.setHours(0,0,0,0),t}function m(e){var t;let l=function(e,t){let l=u(e).getTime();return Math.round((u(t).getTime()-l)/864e5)}(u(new Date),u(c(e.outage_date))),a=l<0?"เลยกำหนด ".concat(Math.abs(l)," วัน"):0===l?"วันนี้":1===l?"พรุ่งนี้":"เหลือ ".concat(l," วัน");return l<0?{daysLeft:l,color:"RED",label:a}:"PENDING"===(null!==(t=e.nakhon_status)&&void 0!==t?t:"PENDING")?l<14?{daysLeft:l,color:"RED",label:a}:l<=28?{daysLeft:l,color:"YELLOW",label:a}:{daysLeft:l,color:"GREEN",label:a}:l<3?{daysLeft:l,color:"RED",label:a}:l<=6?{daysLeft:l,color:"YELLOW",label:a}:{daysLeft:l,color:"GREEN",label:a}}let x=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"];function _(e){var t,l,a,s,n,o;let i=null!==(t=e.doc_purpose)&&void 0!==t?t:"",r=null!==(l=e.doc_area_title)&&void 0!==l?l:"",d=null!==(a=e.doc_time_start)&&void 0!==a?a:"",u=null!==(s=e.doc_time_end)&&void 0!==s?s:"",m=null!==(n=e.doc_area_detail)&&void 0!==n?n:"",_=null!==(o=e.map_link)&&void 0!==o?o:"",p=function(e){var t;if(!e)return"";let l=c(e),a=l.getDate(),s=null!==(t=x[l.getMonth()])&&void 0!==t?t:"",n=l.getFullYear()+543;return"".concat(a," ").concat(s," ").concat(n).trim()}(e.outage_date);return["เพื่อ".concat(i," บริเวณ ").concat(r),"\uD83D\uDCC5".concat(p),"☣️โซนสีเหลือง แสดงพื้นที่ไฟดับ ตั้งแต่เวลา ".concat(d," .- ").concat(u," น."),"\uD83C\uDF0Fบริเวณพื้นที่ผู้ใช้ไฟได้รับผลกระทบ ".concat(m),"\uD83D\uDCCCกดลิ้งค์ \uD83D\uDC47 เพื่อตรวจสอบพื้นที่ไฟดับ ".concat(_)].join("\n")}function p(e){let{job:t,isOpen:l,onClose:s,onJobUpdate:r}=e,[c,u]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null),p=(0,n.useMemo)(()=>{var e;return t?(null===(e=t.social_post_text)||void 0===e?void 0:e.trim())?t.social_post_text:_(t):""},[t]);(0,n.useEffect)(()=>{if(!m)return;let e=window.setTimeout(()=>{x(null)},3e3);return()=>window.clearTimeout(e)},[m]);let h=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(p)try{await navigator.clipboard.writeText(p),e&&x("คัดลอกข้อความแล้ว — ไปวางใน Facebook/LINE ได้เลย")}catch(t){console.error("Failed to copy text",t),e&&x("คัดลอกข้อความไม่สำเร็จ กรุณาลองใหม่")}},f=async()=>{if(t&&p){if("POSTED"===t.social_status){await h();return}u(!0);try{var e,l,a,n,o,i;let d=await fetch("/api/jobs/social-post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:t.id})}),c=await d.json().catch(()=>null);if(!d.ok||!(null==c?void 0:c.ok))throw Error(null!==(e=null==c?void 0:c.error)&&void 0!==e?e:"ไม่สามารถโพสต์ข้อความได้");let u=null!==(l=c.social_posted_at)&&void 0!==l?l:new Date().toISOString(),m=null!==(n=null!==(a=c.social_post_text)&&void 0!==a?a:c.preview_text)&&void 0!==n?n:_(t);r(t.id,{...null!==(o=c.job)&&void 0!==o?o:{},social_status:null!==(i=c.social_status)&&void 0!==i?i:"POSTED",social_post_text:m,social_posted_at:u}),h(!1),x("โพสต์ข้อความสำเร็จแล้ว"),window.setTimeout(()=>{s()},500)}catch(e){console.error("Social post failed",e),x("โพสต์ข้อความไม่สำเร็จ กรุณาลองใหม่")}finally{u(!1)}}};return(0,a.jsx)(i.Z,{isOpen:l,title:"ตัวอย่างข้อความโพสต์ Social",onClose:s,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[m?(0,a.jsx)("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:m}):null,(0,a.jsx)("div",{className:"rounded-xl border border-slate-200/70 bg-slate-50 p-3 text-sm text-slate-700",children:(0,a.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed",children:p||"-"})}),(0,a.jsx)("div",{className:"rounded-xl border border-slate-200/70 bg-white p-3",children:(0,a.jsx)(o.Z,{googleUrl:null==t?void 0:t.map_link,myMapUrl:null==t?void 0:t.mymaps_url})}),(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsx)(d.Z,{type:"button",variant:"secondary",onClick:()=>void h(!0),children:"คัดลอกข้อความ"}),(0,a.jsx)(d.Z,{type:"button",onClick:f,disabled:c||!p,children:c?"กำลังโพสต์...":"Post ลงสื่อ social"})]})]})})}let h=e=>{switch(e){case"RED":return"border border-rose-200/80 bg-rose-50 text-rose-700";case"YELLOW":return"border border-amber-200/80 bg-amber-50 text-amber-700";default:return"border border-emerald-200/80 bg-emerald-50 text-emerald-700"}};function f(e){let{status:t,label:l}=e;return(0,a.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold ".concat(h(t)),children:l})}var b=l(649),g=l(4608),v=l(9155),j=l(9354);function N(e){let{options:t,value:l,onChange:s,className:n}=e;return(0,a.jsx)("div",{role:"group",className:(0,j.cn)("inline-flex items-center rounded-full bg-slate-100/80 p-1 text-sm shadow-inner",n),children:t.map(e=>{let t=l===e.id;return(0,a.jsx)("button",{type:"button",onClick:()=>s(e.id),className:(0,j.cn)("rounded-full px-4 py-1.5 text-xs font-semibold uppercase tracking-wide transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-fuchsia-300 focus-visible:ring-offset-2",t?"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-900"),children:e.label},e.id)})})}var y=l(1707),w=l(3866);let k=e=>{var t;if(!e)return null;let l=e.match(/filename\*=UTF-8''([^;]+)/i);if(null==l?void 0:l[1])try{return decodeURIComponent(l[1])}catch(e){return l[1]}let a=e.match(/filename="?([^";]+)"?/i);return null!==(t=null==a?void 0:a[1])&&void 0!==t?t:null},E=e=>{var t,l,a;if("PENDING"===(null!==(t=e.nakhon_status)&&void 0!==t?t:"PENDING"))return"notify_nakhon";if(!("GENERATED"===e.doc_status||e.doc_generated_at))return"create_doc";let s=null!==(l=e.social_status)&&void 0!==l?l:"DRAFT";if("PENDING_APPROVAL"===s)return"wait_approval";let n=null!==(a=e.notice_status)&&void 0!==a?a:"NONE";return"POSTED"===s&&"SCHEDULED"!==n?"notify_outage_letter":"close_job"},D={notify_nakhon:"แจ้งศูนย์นคร",create_doc:"สร้างเอกสารดับไฟ",wait_approval:"รออนุมัติ",notify_outage_letter:"แจ้งหนังสือดับไฟ",close_job:"ปิดงาน"},C=e=>e?"primary":"secondary";function S(){let e=(0,s.useRouter)(),[t,l]=(0,n.useState)([]),[u,x]=(0,n.useState)(!0),[_,h]=(0,n.useState)(null),[j,S]=(0,n.useState)(""),[O,T]=(0,n.useState)("all"),[Z,P]=(0,n.useState)("active"),[L,R]=(0,n.useState)(null),[I,U]=(0,n.useState)({}),[G,F]=(0,n.useState)(null),[A,q]=(0,n.useState)(""),[Y,z]=(0,n.useState)(""),[H,M]=(0,n.useState)({}),[J,W]=(0,n.useState)(!1),[Q,V]=(0,n.useState)(null),[K,B]=(0,n.useState)(null),[X,$]=(0,n.useState)(null),[ee,et]=(0,n.useState)({doc_issue_date:"",doc_purpose:"",doc_area_title:"",doc_time_start:"",doc_time_end:"",doc_area_detail:"",map_link:""}),[el,ea]=(0,n.useState)({}),[es,en]=(0,n.useState)(!1),[eo,ei]=(0,n.useState)(null),[er,ed]=(0,n.useState)(!1),[ec,eu]=(0,n.useState)(null),[em,ex]=(0,n.useState)(null),[e_,ep]=(0,n.useState)(null),eh=async()=>{x(!0),h(null),R(null);let{data:e,error:t}=await (0,y.DQ)();t?(h(t.message),l([])):l(null!=e?e:[]),x(!1)};(0,n.useEffect)(()=>{eh()},[]),(0,n.useEffect)(()=>{(async()=>{var e,t;let{data:l}=await w.O.auth.getUser();ep(null!==(t=null===(e=l.user)||void 0===e?void 0:e.email)&&void 0!==t?t:null)})();let{data:e}=w.O.auth.onAuthStateChange((e,t)=>{var l,a;ep(null!==(a=null==t?void 0:null===(l=t.user)||void 0===l?void 0:l.email)&&void 0!==a?a:null)});return()=>{e.subscription.unsubscribe()}},[]),(0,n.useEffect)(()=>{if(!em)return;let e=window.setTimeout(()=>{ex(null)},2e3);return()=>window.clearTimeout(e)},[em]);let ef=()=>{F(null),q(""),z(""),M({}),W(!1)},eb=()=>{V(null),et({doc_issue_date:"",doc_purpose:"",doc_area_title:"",doc_time_start:"",doc_time_end:"",doc_area_detail:"",map_link:""}),ea({}),en(!1)},eg=()=>{$(null)},ev=e=>{F(e),q(""),z(""),M({})},ej=e=>{var t,l,a,s,n,o,i;V(e),et({doc_issue_date:null!==(t=e.doc_issue_date)&&void 0!==t?t:"",doc_purpose:null!==(l=e.doc_purpose)&&void 0!==l?l:"",doc_area_title:null!==(a=e.doc_area_title)&&void 0!==a?a:"",doc_time_start:null!==(s=e.doc_time_start)&&void 0!==s?s:"",doc_time_end:null!==(n=e.doc_time_end)&&void 0!==n?n:"",doc_area_detail:null!==(o=e.doc_area_detail)&&void 0!==o?o:"",map_link:null!==(i=e.map_link)&&void 0!==i?i:""}),ea({})},eN=e=>{ei(e),ed(!1),eu(null)},ey=async()=>{if(!eo)return;ed(!0),eu(null);let{data:t}=await w.O.auth.getSession();if(!t.session){ed(!1),ei(null),e.push("/login");return}try{let t=await fetch("/api/jobs/".concat(eo.id,"/close"),{method:"POST",headers:{"Content-Type":"application/json"}});if(401===t.status){ed(!1),ei(null),e.push("/login");return}let a=await t.json().catch(()=>null);if(!t.ok||!(null==a?void 0:a.ok)){var l;throw Error(null!==(l=null==a?void 0:a.error)&&void 0!==l?l:"ปิดงานไม่สำเร็จ กรุณาลองใหม่")}ex({message:"✅ ปิดงานเรียบร้อย",tone:"success"}),await eh(),ei(null)}catch(t){let e=t instanceof Error?t.message:"ปิดงานไม่สำเร็จ กรุณาลองใหม่";eu(e),ex({message:e,tone:"error"})}finally{ed(!1)}},ew=async()=>{await w.O.auth.signOut(),await fetch("/api/auth/session",{method:"DELETE"}),e.push("/login")},ek=async()=>{if(!G)return;let e={};if(A||(e.date="กรุณาระบุวันที่แจ้งศูนย์นคร"),Y.trim()||(e.memoNo="กรุณาระบุเลขที่บันทึก"),Object.keys(e).length>0){M(e);return}W(!0),M({});let{error:t}=await (0,y.Z6)(G.id,{date:A,memoNo:Y.trim()});if(t){M({submit:t.message||"บันทึกไม่สำเร็จ กรุณาลองใหม่"}),W(!1);return}l(e=>e.map(e=>e.id===G.id?{...e,nakhon_status:"NOTIFIED",nakhon_notified_date:A,nakhon_memo_no:Y.trim()}:e)),ef()},eE=async e=>{R(null),U(t=>({...t,[e.id]:!0}));let{error:t}=await (0,y.uA)(e.id);if(t){R(t.message||"อัปเดตไม่สำเร็จ"),U(t=>({...t,[e.id]:!1}));return}l(t=>t.map(t=>t.id===e.id?{...t,nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}:t)),U(t=>({...t,[e.id]:!1}))},eD=async()=>{if(!Q)return;let e={};if(ee.doc_issue_date||(e.doc_issue_date="กรุณาระบุวันที่ออกหนังสือ"),ee.doc_purpose.trim()||(e.doc_purpose="กรุณาระบุวัตถุประสงค์"),ee.doc_area_title.trim()||(e.doc_area_title="กรุณาระบุบริเวณที่ดับ"),ee.doc_time_start.trim()||(e.doc_time_start="กรุณาระบุเวลาเริ่มดับไฟ"),ee.doc_time_end.trim()||(e.doc_time_end="กรุณาระบุเวลาจ่ายไฟ"),ee.doc_area_detail.trim()||(e.doc_area_detail="กรุณาระบุรายละเอียดพื้นที่ดับไฟ"),ee.map_link.trim()||(e.map_link="กรุณาระบุลิ้ง google map"),Object.keys(e).length>0){ea(e);return}let t={doc_issue_date:ee.doc_issue_date,doc_purpose:ee.doc_purpose.trim(),doc_area_title:ee.doc_area_title.trim(),doc_time_start:ee.doc_time_start.trim(),doc_time_end:ee.doc_time_end.trim(),doc_area_detail:ee.doc_area_detail.trim(),map_link:ee.map_link.trim()};en(!0),ea({});try{var a,s;let e=await fetch("/api/docs/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:Q.id,payload:t})});if(!e.ok){let t=null!==(a=e.headers.get("Content-Type"))&&void 0!==a?a:"",l="";if(t.includes("application/json")){let t=await e.json().catch(()=>null);l=(null==t?void 0:t.error)||(null==t?void 0:t.message)||""}else l=await e.text().catch(()=>"");ea({submit:l?"ไม่สามารถสร้างเอกสารได้ กรุณาลองใหม่ (".concat(l,")"):"ไม่สามารถสร้างเอกสารได้ กรุณาลองใหม่"}),en(!1);return}let n=await e.blob(),o=window.URL.createObjectURL(n),i=null!==(s=k(e.headers.get("Content-Disposition")))&&void 0!==s?s:"outage-doc-".concat(Q.id,".docx"),r=document.createElement("a");r.href=o,r.download=i,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(o);let d=new Date().toISOString();l(e=>e.map(e=>e.id===Q.id?{...e,...t,doc_status:"GENERATED",doc_url:null,doc_generated_at:d}:e));try{let e=await fetch("/api/jobs/social-pending",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:Q.id})}),t=await e.json().catch(()=>null);e.ok&&(null==t?void 0:t.ok)?l(e=>e.map(e=>e.id===Q.id?{...e,social_status:"PENDING_APPROVAL"}:e)):console.warn("Failed to set social pending status",t)}catch(e){console.warn("Failed to set social pending status",e)}eb()}catch(e){console.error(e),ea({submit:"สร้างเอกสารไม่สำเร็จ กรุณาลองใหม่"}),en(!1)}},eC=(0,n.useMemo)(()=>{let e=j.trim().toLowerCase();return t.filter(e=>"closed"===Z?e.is_closed:!e.is_closed).filter(t=>!e||t.equipment_code.toLowerCase().includes(e)).filter(e=>"all"===O||m(e).color.toLowerCase()===O).sort((e,t)=>{if("closed"===Z){let l=e.closed_at?new Date(e.closed_at).getTime():0;return(t.closed_at?new Date(t.closed_at).getTime():0)-l}return c(e.outage_date).getTime()-c(t.outage_date).getTime()})},[t,j,O,Z]);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)(g.Zb,{className:"bg-white/80",children:[(0,a.jsx)(g.Ol,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:"Jobs"}),(0,a.jsx)(g.ll,{children:"Krabi Outage Tracker"}),(0,a.jsx)(g.SZ,{children:"ติดตามงานดับไฟตามกำหนดและสถานะวันคงเหลือ"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[e_?(0,a.jsx)(b.Z,{variant:"neutral",children:e_}):null,(0,a.jsx)(d.Z,{type:"button",variant:"secondary",size:"sm",onClick:ew,children:"ออกจากระบบ"})]})]})}),(0,a.jsxs)(g.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between",children:[(0,a.jsxs)("div",{className:"flex w-full max-w-md flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-600",children:"ค้นหาอุปกรณ์"}),(0,a.jsx)(v.Z,{value:j,onChange:e=>S(e.target.value),placeholder:"กรอกรหัสอุปกรณ์"})]}),(0,a.jsx)(N,{options:[{id:"all",label:"ทั้งหมด"},{id:"green",label:"เขียว"},{id:"yellow",label:"เหลือง"},{id:"red",label:"แดง"}],value:O,onChange:T})]}),(0,a.jsx)(N,{options:[{id:"active",label:"กำลังดำเนินการ"},{id:"closed",label:"ปิดแล้ว"}],value:Z,onChange:P})]})]}),em?(0,a.jsx)(g.Zb,{className:"".concat("success"===em.tone?"border-emerald-200 bg-emerald-50/80":"border-rose-200 bg-rose-50/80"),children:(0,a.jsx)(g.aY,{className:"py-3 text-sm ".concat("success"===em.tone?"text-emerald-700":"text-rose-700"),children:em.message})}):null,_?(0,a.jsx)(g.Zb,{className:"border-rose-200 bg-rose-50/80",children:(0,a.jsx)(g.aY,{className:"py-3 text-sm text-rose-700",children:_})}):null,L?(0,a.jsx)(g.Zb,{className:"border-amber-200 bg-amber-50/80",children:(0,a.jsx)(g.aY,{className:"py-3 text-sm text-amber-700",children:L})}):null,(0,a.jsx)("section",{className:"grid gap-4",children:u?(0,a.jsx)(g.Zb,{children:(0,a.jsx)(g.aY,{className:"py-8 text-center text-sm text-slate-500",children:"กำลังโหลดข้อมูล..."})}):0===eC.length?(0,a.jsx)(g.Zb,{children:(0,a.jsx)(g.aY,{className:"py-8 text-center text-sm text-slate-500",children:"ยังไม่มีงานที่ตรงกับตัวกรอง"})}):eC.map(t=>{var l,s,n,i,r,u,x,_;let p=m(t),h="RED"===(_=p.color)?{strip:"bg-rose-200/80",badge:"border border-rose-200/80 bg-rose-50 text-rose-700",text:"text-rose-700"}:"YELLOW"===_?{strip:"bg-amber-200/80",badge:"border border-amber-200/80 bg-amber-50 text-amber-700",text:"text-amber-700"}:{strip:"bg-emerald-200/80",badge:"border border-emerald-200/80 bg-emerald-50 text-emerald-700",text:"text-emerald-700"},v=null!==(s=t.nakhon_status)&&void 0!==s?s:"PENDING",j="NOTIFIED"===v,N=null!==(n=I[t.id])&&void 0!==n&&n,y=null!==(i=t.is_closed)&&void 0!==i&&i,w="GENERATED"===t.doc_status||!!t.doc_generated_at,k="GENERATING"===t.doc_status,S=null!==(r=t.social_status)&&void 0!==r?r:"DRAFT",O=null!==(u=t.notice_status)&&void 0!==u?u:"NONE",T=E(t),Z=D[T];return(0,a.jsxs)(g.Zb,{className:"group flex items-stretch overflow-hidden transition hover:-translate-y-0.5",children:[(0,a.jsx)("div",{className:"w-1.5 ".concat(h.strip)}),(0,a.jsxs)("div",{className:"flex w-full flex-col gap-4 p-5 sm:flex-row sm:items-start sm:justify-between",children:[(0,a.jsxs)("div",{className:"flex min-w-[240px] flex-1 flex-col gap-4",children:[(0,a.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>e.push("/job/".concat(t.id)),onKeyDown:l=>{("Enter"===l.key||" "===l.key)&&(l.preventDefault(),e.push("/job/".concat(t.id)))},className:"cursor-pointer space-y-4 rounded-2xl outline-none transition focus-visible:ring-2 focus-visible:ring-fuchsia-300 focus-visible:ring-offset-2",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm text-slate-500",children:c(t.outage_date).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(h.text),children:p.label})]}),(0,a.jsx)(f,{status:p.color,label:p.color})]}),y?(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs font-medium text-slate-600",children:[(0,a.jsx)(b.Z,{variant:"neutral",children:"ปิดแล้ว"}),(0,a.jsxs)("span",{children:["ปิดเมื่อ"," ",t.closed_at?new Date(t.closed_at).toLocaleString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"]})]}):null,(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-lg font-semibold tracking-tight text-slate-900",children:t.equipment_code}),(0,a.jsx)("p",{className:"text-sm text-slate-600",children:(null===(l=t.note)||void 0===l?void 0:l.trim())||"ไม่มีหมายเหตุ"})]}),(j||"NOT_REQUIRED"===v)&&(0,a.jsx)("div",{className:"text-sm text-slate-600",children:j?(0,a.jsxs)(a.Fragment,{children:["แจ้งศูนย์นครแล้ว:"," ",(0,a.jsx)("span",{className:"font-medium text-slate-800",children:t.nakhon_notified_date?c(t.nakhon_notified_date).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"}):"-"})," ","| เลขที่บันทึก:"," ",(0,a.jsx)("span",{className:"font-medium text-slate-800",children:null!==(x=t.nakhon_memo_no)&&void 0!==x?x:"-"})]}):(0,a.jsx)("span",{children:"ไม่ต้องแจ้งศูนย์นคร"})})]}),(0,a.jsx)(o.Z,{googleUrl:t.map_link,myMapUrl:t.mymaps_url})]}),y?null:(0,a.jsxs)("div",{className:"flex w-full flex-col items-stretch gap-2 sm:w-auto sm:min-w-[220px]",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-slate-500",children:["ขั้นตอนถัดไป:"," ",(0,a.jsx)("span",{className:"text-slate-700",children:Z})]}),"PENDING"===v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.Z,{type:"button",size:"sm",variant:C("notify_nakhon"===T),className:"w-full",onClick:()=>ev(t),children:"แจ้งศูนย์นครแล้ว"}),(0,a.jsx)(d.Z,{type:"button",variant:"secondary",size:"sm",className:"w-full",onClick:()=>eE(t),disabled:N,children:N?"กำลังบันทึก...":"ไม่ต้องแจ้งศูนย์นคร"})]}):(0,a.jsx)(a.Fragment,{children:w?t.doc_url?(0,a.jsx)(d.Z,{type:"button",size:"sm",variant:C("create_doc"===T),className:"w-full",onClick:()=>{if(t.doc_url){window.open(t.doc_url,"_blank","noopener,noreferrer");return}ej(t)},children:"พิมพ์เอกสาร"}):(0,a.jsx)(d.Z,{type:"button",variant:"secondary",size:"sm",className:"w-full",onClick:()=>ej(t),children:"ดาวน์โหลดเอกสารอีกครั้ง"}):(0,a.jsx)(d.Z,{type:"button",size:"sm",variant:C("create_doc"===T),className:"w-full",onClick:()=>ej(t),disabled:N||k,children:k?"กำลังสร้าง...":"สร้างเอกสารดับไฟ"})}),"PENDING_APPROVAL"===S||"POSTED"===S?(0,a.jsx)(d.Z,{type:"button",size:"sm",variant:C("wait_approval"===T),className:"w-full",onClick:()=>B(t),children:"POSTED"===S?"Posted แล้วสื่อ Social":"รออนุมัติ"}):null,"POSTED"===S?(0,a.jsx)(d.Z,{type:"button",size:"sm",variant:C("notify_outage_letter"===T),className:"w-full",onClick:()=>$(t),children:"SCHEDULED"===O?"กำหนดการแจ้งเรียบร้อยแล้ว (แก้ไขได้)":"แจ้งหนังสือดับไฟ"}):null,"SCHEDULED"!==O||y?null:(0,a.jsx)(d.Z,{type:"button",size:"sm",variant:C("close_job"===T),className:"w-full",onClick:()=>eN(t),children:"ปิดงาน"})]})]})]},t.id)})}),(0,a.jsx)(i.Z,{isOpen:!!G,title:"แจ้งศูนย์นครแล้ว",onClose:ef,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["วันที่แจ้งศูนย์นคร",(0,a.jsx)(v.Z,{type:"date",value:A,onChange:e=>q(e.target.value),required:!0}),H.date?(0,a.jsx)("span",{className:"text-xs text-red-600",children:H.date}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["เลขที่บันทึก",(0,a.jsx)(v.Z,{type:"text",value:Y,onChange:e=>z(e.target.value),required:!0}),H.memoNo?(0,a.jsx)("span",{className:"text-xs text-red-600",children:H.memoNo}):null]}),H.submit?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:H.submit}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsx)(d.Z,{type:"button",variant:"secondary",onClick:ef,children:"ยกเลิก"}),(0,a.jsx)(d.Z,{type:"button",onClick:ek,disabled:J,children:J?"กำลังบันทึก...":"ตกลง"})]})]})}),(0,a.jsx)(i.Z,{isOpen:!!Q,title:"สร้างเอกสารดับไฟ",onClose:eb,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["หนังสือลงวันที่",(0,a.jsx)(v.Z,{type:"date",value:ee.doc_issue_date,onChange:e=>et(t=>({...t,doc_issue_date:e.target.value})),required:!0}),el.doc_issue_date?(0,a.jsx)("span",{className:"text-xs text-red-600",children:el.doc_issue_date}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["ดับไฟเพื่อ",(0,a.jsx)(v.Z,{type:"text",value:ee.doc_purpose,onChange:e=>et(t=>({...t,doc_purpose:e.target.value})),required:!0}),el.doc_purpose?(0,a.jsx)("span",{className:"text-xs text-red-600",children:el.doc_purpose}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["บริเวณที่ดับ",(0,a.jsx)(v.Z,{type:"text",value:ee.doc_area_title,onChange:e=>et(t=>({...t,doc_area_title:e.target.value})),required:!0}),el.doc_area_title?(0,a.jsx)("span",{className:"text-xs text-red-600",children:el.doc_area_title}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["เวลาเริ่มดับไฟ",(0,a.jsx)(v.Z,{type:"time",value:ee.doc_time_start,onChange:e=>et(t=>({...t,doc_time_start:e.target.value})),required:!0}),el.doc_time_start?(0,a.jsx)("span",{className:"text-xs text-red-600",children:el.doc_time_start}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["เวลาจ่ายไฟ",(0,a.jsx)(v.Z,{type:"time",value:ee.doc_time_end,onChange:e=>et(t=>({...t,doc_time_end:e.target.value})),required:!0}),el.doc_time_end?(0,a.jsx)("span",{className:"text-xs text-red-600",children:el.doc_time_end}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["รายละเอียดพื้นที่ดับไฟ",(0,a.jsx)("textarea",{value:ee.doc_area_detail,onChange:e=>et(t=>({...t,doc_area_detail:e.target.value})),rows:3,className:"w-full rounded-xl border border-slate-200/80 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm transition focus:border-fuchsia-400 focus:outline-none focus:ring-2 focus:ring-fuchsia-200",required:!0}),el.doc_area_detail?(0,a.jsx)("span",{className:"text-xs text-red-600",children:el.doc_area_detail}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["ลิ้ง google map",(0,a.jsx)(v.Z,{type:"url",value:ee.map_link,onChange:e=>et(t=>({...t,map_link:e.target.value})),required:!0}),el.map_link?(0,a.jsx)("span",{className:"text-xs text-red-600",children:el.map_link}):null]}),el.submit?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:el.submit}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsx)(d.Z,{type:"button",variant:"secondary",onClick:eb,children:"ยกเลิก"}),(0,a.jsx)(d.Z,{type:"button",onClick:eD,disabled:es,children:es?"กำลังสร้าง...":"สร้าง"})]})]})}),(0,a.jsx)(p,{job:K,isOpen:!!K,onClose:()=>{B(null)},onJobUpdate:(e,t)=>{l(l=>l.map(l=>l.id===e?{...l,...t}:l)),B(l=>(null==l?void 0:l.id)===e?{...l,...t}:l)}}),(0,a.jsx)(r.Z,{job:X,open:!!X,onOpenChange:e=>{e||eg()},onJobUpdate:(e,t)=>{l(l=>l.map(l=>l.id===e?{...l,...t}:l)),$(l=>(null==l?void 0:l.id)===e?{...l,...t}:l)}}),(0,a.jsx)(i.Z,{isOpen:!!eo,title:"ยืนยันปิดงาน?",onClose:()=>ei(null),children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)("p",{className:"text-sm text-slate-600",children:'ปิดงานแล้วจะถูกย้ายไปที่ "งานที่ปิดแล้ว" และไม่สามารถแก้ไขได้'}),ec?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:ec}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsx)(d.Z,{type:"button",variant:"secondary",onClick:()=>ei(null),children:"ยกเลิก"}),(0,a.jsx)(d.Z,{type:"button",onClick:ey,disabled:er,children:er?"กำลังปิดงาน...":"ยืนยันปิดงาน"})]})]})})]})}}},function(e){e.O(0,[200,877,971,23,744],function(){return e(e.s=10)}),_N_E=e.O()}]);