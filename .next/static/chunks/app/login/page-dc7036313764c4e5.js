(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{272:function(e,t,s){Promise.resolve().then(s.bind(s,1193))},1193:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var a=s(7437),l=s(2265),n=s(6463),r=s(3866),o=s(2157);function i(){let e=(0,n.useRouter)(),[t,s]=(0,l.useState)(""),[i,d]=(0,l.useState)(""),[u,c]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),[m,p]=(0,l.useState)(null);(0,l.useEffect)(()=>{(async()=>{let{data:t}=await r.O.auth.getSession();t.session&&(await (0,o.X)(t.session),e.replace("/dashboard"))})()},[e]);let b=async s=>{s.preventDefault(),c(!0),h(null),p(null);let{data:a,error:l}=await r.O.auth.signInWithPassword({email:t,password:i});if(l||!a.session){h("อีเมลหรือรหัสผ่านไม่ถูกต้อง"),c(!1);return}await (0,o.X)(a.session),e.push("/dashboard")},f=async()=>{if(c(!0),h(null),p(null),!t||!i){h("กรุณากรอกอีเมลและรหัสผ่าน"),c(!1);return}let{data:s,error:a}=await r.O.auth.signUp({email:t,password:i});if(a){h(a.message),c(!1);return}if(s.session){await (0,o.X)(s.session),e.push("/dashboard");return}p("สมัครสำเร็จ กรุณาตรวจสอบอีเมลเพื่อยืนยันบัญชี"),c(!1)};return(0,a.jsx)("div",{className:"flex min-h-[70vh] items-center justify-center",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-3xl border border-slate-200 bg-white p-8 shadow-xl",children:[(0,a.jsxs)("div",{className:"mb-6 space-y-2",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold text-slate-900",children:"เข้าสู่ระบบ"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"จัดการงานดับไฟได้ทันทีด้วยบัญชีของคุณ"})]}),(0,a.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["อีเมล",(0,a.jsx)("input",{type:"email",value:t,onChange:e=>s(e.target.value),placeholder:"you@example.com",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none transition focus:border-slate-400",required:!0})]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["รหัสผ่าน",(0,a.jsx)("input",{type:"password",value:i,onChange:e=>d(e.target.value),placeholder:"••••••••",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none transition focus:border-slate-400",required:!0})]}),x?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:x}):null,m?(0,a.jsx)("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:m}):null,(0,a.jsx)("button",{type:"submit",disabled:u,className:"w-full rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:u?"กำลังเข้าสู่ระบบ...":"เข้าสู่ระบบ"})]}),(0,a.jsxs)("div",{className:"mt-4 flex flex-col gap-3 text-center text-sm text-slate-500",children:[(0,a.jsx)("span",{children:"หรือ"}),(0,a.jsx)("button",{type:"button",onClick:f,disabled:u,className:"w-full rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-70",children:"สมัครด้วยอีเมลนี้"})]})]})})}},3866:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});let a=(0,s(2157).e)()},2157:function(e,t,s){"use strict";s.d(t,{X:function(){return c},e:function(){return u}});var a=s(7327);s(357);let l="https://yhkrzepnokhiqbxwhkgz.supabase.co",n="sb_publishable_CdTtNwP3k39LxhkLkKbS3w_Y3co_tFE",r=null,o=!1,i=()=>{if(!l||!n)throw Error("Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.")},d=async(e,t)=>{e&&t?await fetch("/api/auth/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:e,refreshToken:t})}):await fetch("/api/auth/session",{method:"DELETE"})},u=()=>(i(),r||(r=(0,a.eI)(l,n)),o||(o=!0,r.auth.onAuthStateChange((e,t)=>{var s,a;d(null!==(s=null==t?void 0:t.access_token)&&void 0!==s?s:null,null!==(a=null==t?void 0:t.refresh_token)&&void 0!==a?a:null)})),r),c=async e=>{await d(e.access_token,e.refresh_token)}}},function(e){e.O(0,[200,971,23,744],function(){return e(e.s=272)}),_N_E=e.O()}]);