"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{9320:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(7437);function a(e){let{isOpen:t,title:n,onClose:a,children:l}=e;return t?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm",onClick:a,role:"presentation"}),(0,r.jsxs)("div",{className:"relative z-10 w-full max-w-lg rounded-2xl border border-slate-200/70 bg-white p-6 shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[n?(0,r.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:n}):null,(0,r.jsx)("button",{type:"button",onClick:a,className:"text-sm font-medium text-slate-500 hover:text-slate-700",children:"ปิด"})]}),(0,r.jsx)("div",{className:"mt-4",children:l})]})]}):null}},3442:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(7437),a=n(2265),l=n(9320),o=n(6760),s=n(9155);function i(e){let{open:t,onOpenChange:n,job:i,onJobUpdate:u}=e,[c,d]=(0,a.useState)(""),[f,m]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),[x,b]=(0,a.useState)({}),[g,y]=(0,a.useState)(!1),[v,_]=(0,a.useState)(null);(0,a.useEffect)(()=>{var e,n,r;t&&(d(null!==(e=null==i?void 0:i.notice_date)&&void 0!==e?e:""),m(null!==(n=null==i?void 0:i.notice_by)&&void 0!==n?n:""),p(null!==(r=null==i?void 0:i.mymaps_url)&&void 0!==r?r:""),b({}),_(null),y(!1))},[t,i]),(0,a.useEffect)(()=>{if(!v)return;let e=window.setTimeout(()=>{_(null)},2e3);return()=>window.clearTimeout(e)},[v]);let w=async()=>{if(!i)return;let e={},t=h.trim();if(c||(e.noticeDate="กรุณาระบุวันที่จะไปดำเนินการแจ้ง"),f.trim()||(e.noticeBy="กรุณาระบุผู้แจ้ง"),t){let n=/^https?:\/\//i.test(t)?t:"https://".concat(t);try{let e=new URL(n);if("http:"!==e.protocol&&"https:"!==e.protocol)throw Error("invalid protocol")}catch(t){e.mymapsUrl="ลิ้งไม่ถูกต้อง"}}else e.mymapsUrl="กรุณาระบุลิ้ง my map";if(Object.keys(e).length>0){b(e);return}y(!0),b({});try{var r,a;let e=/^https?:\/\//i.test(t)?t:"https://".concat(t),l={jobId:i.id,notice_date:c,notice_by:f.trim(),mymaps_url:e},o=await fetch("/api/jobs/notice-schedule",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),s=await o.json().catch(()=>null);if(!o.ok||!(null==s?void 0:s.ok))throw Error(null!==(r=null==s?void 0:s.error)&&void 0!==r?r:"ไม่สามารถบันทึกกำหนดการได้");let d=null!==(a=s.notice_scheduled_at)&&void 0!==a?a:new Date().toISOString();null==u||u(i.id,{notice_status:"SCHEDULED",notice_date:l.notice_date,notice_by:l.notice_by,mymaps_url:l.mymaps_url,notice_scheduled_at:d}),_("กำหนดการแจ้งเรียบร้อยแล้ว"),setTimeout(()=>{n(!1)},800)}catch(e){console.error("Notice schedule failed",e),b({submit:"บันทึกกำหนดการไม่สำเร็จ กรุณาลองใหม่"})}finally{y(!1)}};return(0,r.jsx)(l.Z,{isOpen:t,title:"แจ้งหนังสือดับไฟ",onClose:()=>n(!1),children:(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[v?(0,r.jsx)("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:v}):null,(0,r.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["วันที่จะไปดำเนินการแจ้ง",(0,r.jsx)(s.Z,{type:"date",value:c,onChange:e=>d(e.target.value),required:!0}),x.noticeDate?(0,r.jsx)("span",{className:"text-xs text-red-600",children:x.noticeDate}):null]}),(0,r.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["ผู้แจ้ง",(0,r.jsx)(s.Z,{type:"text",value:f,onChange:e=>m(e.target.value),required:!0}),x.noticeBy?(0,r.jsx)("span",{className:"text-xs text-red-600",children:x.noticeBy}):null]}),(0,r.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["ลิ้ง my map",(0,r.jsx)(s.Z,{type:"url",value:h,onChange:e=>p(e.target.value),placeholder:"https://",required:!0}),x.mymapsUrl?(0,r.jsx)("span",{className:"text-xs text-red-600",children:x.mymapsUrl}):null]}),x.submit?(0,r.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:x.submit}):null,(0,r.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,r.jsx)(o.Z,{type:"button",variant:"secondary",onClick:()=>n(!1),children:"ยกเลิก"}),(0,r.jsx)(o.Z,{type:"button",onClick:w,disabled:g,children:g?"กำลังบันทึก...":"บันทึกกำหนดการ"})]})]})})}},6600:function(e,t,n){n.d(t,{Z:function(){return y}});var r=n(7437),a=n(2265);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),s=e=>{let t=o(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},u=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,a.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:l=2,absoluteStrokeWidth:o,className:s="",children:d,iconNode:f,...m}=e;return(0,a.createElement)("svg",{ref:t,...c,width:r,height:r,stroke:n,strokeWidth:o?24*Number(l)/Number(r):l,className:i("lucide",s),...!d&&!u(m)&&{"aria-hidden":"true"},...m},[...f.map(e=>{let[t,n]=e;return(0,a.createElement)(t,n)}),...Array.isArray(d)?d:[d]])}),f=(e,t)=>{let n=(0,a.forwardRef)((n,r)=>{let{className:o,...u}=n;return(0,a.createElement)(d,{ref:r,iconNode:t,className:i("lucide-".concat(l(s(e))),"lucide-".concat(e),o),...u})});return n.displayName=s(e),n},m=f("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),h=f("route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]);var p=n(6760),x=n(9354);let b=e=>{let t=null==e?void 0:e.trim();if(!t)return null;let n=/^https?:\/\//i.test(t)?t:"https://".concat(t);try{let e=new URL(n);if("http:"!==e.protocol&&"https:"!==e.protocol)return null;return e.toString()}catch(e){return null}},g=e=>{e.stopPropagation()};function y(e){let{googleUrl:t,myMapUrl:n,className:a=""}=e,l=b(t),o=b(n);if(!l&&!o)return null;let s="h-4 w-4 text-fuchsia-500",i=(0,x.cn)((0,p.$)({variant:"secondary",size:"sm"}),"w-full justify-center md:w-auto"),u=!!(l&&o),c=(e,t,n,a)=>(0,r.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",onClick:g,onPointerDownCapture:g,className:i,children:[n,(0,r.jsx)("span",{className:"whitespace-nowrap text-slate-700",children:t})]});return(0,r.jsxs)("div",{className:"".concat(u?"grid grid-cols-2 gap-2 mt-2 md:mt-1 md:justify-items-start":"mt-2 md:mt-1").concat(a?" ".concat(a):""),children:[l?c(l,"Google Map",(0,r.jsx)(m,{className:s,"aria-hidden":"true"}),!0):null,o?c(o,"My Map",(0,r.jsx)(h,{className:s,"aria-hidden":"true"}),!l):null]})}},649:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(7437),a=n(9354);let l={default:"border border-slate-200/80 bg-slate-100/70 text-slate-600",accent:"border border-fuchsia-200/70 bg-fuchsia-50 text-fuchsia-700",success:"border border-emerald-200/80 bg-emerald-50 text-emerald-700",warning:"border border-amber-200/80 bg-amber-50 text-amber-700",danger:"border border-rose-200/80 bg-rose-50 text-rose-700",neutral:"border border-slate-200/70 bg-white text-slate-700"};function o(e){let{variant:t="default",className:n,...o}=e;return(0,r.jsx)("span",{...o,className:(0,a.cn)("inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold",l[t],n)})}},6760:function(e,t,n){n.d(t,{$:function(){return s},Z:function(){return i}});var r=n(7437),a=n(9354);let l={primary:"bg-gradient-to-r from-fuchsia-500 via-purple-500 to-pink-500 text-white shadow-[0_16px_30px_rgba(236,72,153,0.25)] hover:brightness-110",secondary:"border border-slate-200/80 bg-white text-slate-700 shadow-sm hover:bg-slate-50",ghost:"text-slate-600 hover:bg-slate-100/80 hover:text-slate-900"},o={sm:"px-3 py-1.5 text-xs",md:"px-4 py-2 text-sm",lg:"px-5 py-2.5 text-sm"};function s(e){let{variant:t="primary",size:n="md",className:r}=e;return(0,a.cn)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-full font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-fuchsia-300 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60",l[t],o[n],r)}function i(e){let{className:t,variant:n,size:a,...l}=e;return(0,r.jsx)("button",{...l,className:s({variant:n,size:a,className:t})})}},4608:function(e,t,n){n.d(t,{Ol:function(){return o},SZ:function(){return i},Zb:function(){return l},aY:function(){return u},ll:function(){return s}});var r=n(7437),a=n(9354);function l(e){let{className:t,...n}=e;return(0,r.jsx)("div",{...n,className:(0,a.cn)("rounded-2xl border border-slate-200/70 bg-white shadow-sm",t)})}function o(e){let{className:t,...n}=e;return(0,r.jsx)("div",{...n,className:(0,a.cn)("px-5 pt-5",t)})}function s(e){let{className:t,...n}=e;return(0,r.jsx)("h3",{...n,className:(0,a.cn)("text-lg font-semibold tracking-tight text-slate-900",t)})}function i(e){let{className:t,...n}=e;return(0,r.jsx)("p",{...n,className:(0,a.cn)("text-sm text-slate-600",t)})}function u(e){let{className:t,...n}=e;return(0,r.jsx)("div",{...n,className:(0,a.cn)("px-5 pb-5",t)})}},9155:function(e,t,n){var r=n(7437),a=n(2265),l=n(9354);let o=(0,a.forwardRef)((e,t)=>{let{className:n,type:a,...o}=e;return(0,r.jsx)("input",{ref:t,type:a,className:(0,l.cn)("w-full rounded-xl border border-slate-200/80 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm transition focus:border-fuchsia-400 focus:outline-none focus:ring-2 focus:ring-fuchsia-200",n),...o})});o.displayName="Input",t.Z=o},1707:function(e,t,n){n.d(t,{Cq:function(){return o},DQ:function(){return a},Z6:function(){return i},Zn:function(){return l},gK:function(){return s},uA:function(){return u}});var r=n(3866);async function a(){return r.O.from("outage_jobs").select("*").order("outage_date",{ascending:!0})}async function l(e){return r.O.from("outage_jobs").select("*").eq("id",e).single()}async function o(e){var t;return r.O.from("outage_jobs").insert({outage_date:e.outage_date,equipment_code:e.equipment_code,note:null!==(t=e.note)&&void 0!==t?t:null})}async function s(e,t){var n;return r.O.from("outage_jobs").update({outage_date:t.outage_date,equipment_code:t.equipment_code,note:null!==(n=t.note)&&void 0!==n?n:null}).eq("id",e)}async function i(e,t){return r.O.from("outage_jobs").update({nakhon_status:"NOTIFIED",nakhon_notified_date:t.date,nakhon_memo_no:t.memoNo}).eq("id",e)}async function u(e){return r.O.from("outage_jobs").update({nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}).eq("id",e)}},3866:function(e,t,n){n.d(t,{O:function(){return r}});let r=(0,n(2157).e)()},2157:function(e,t,n){n.d(t,{X:function(){return d},e:function(){return c}});var r=n(7327);n(357);let a="https://yhkrzepnokhiqbxwhkgz.supabase.co",l="sb_publishable_CdTtNwP3k39LxhkLkKbS3w_Y3co_tFE",o=null,s=!1,i=()=>{if(!a||!l)throw Error("Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.")},u=async(e,t)=>{e&&t?await fetch("/api/auth/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accessToken:e,refreshToken:t})}):await fetch("/api/auth/session",{method:"DELETE"})},c=()=>(i(),o||(o=(0,r.eI)(a,l)),s||(s=!0,o.auth.onAuthStateChange((e,t)=>{var n,r;u(null!==(n=null==t?void 0:t.access_token)&&void 0!==n?n:null,null!==(r=null==t?void 0:t.refresh_token)&&void 0!==r?r:null)})),o),d=async e=>{await u(e.access_token,e.refresh_token)}},9354:function(e,t,n){n.d(t,{cn:function(){return r}});function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(Boolean).join(" ")}}}]);