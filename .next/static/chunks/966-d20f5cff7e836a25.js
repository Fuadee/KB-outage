"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{7966:function(e,t,l){l.r(t),l.d(t,{default:function(){return L}});var a=l(7437),s=l(7138),o=l(6463),n=l(2265),i=l(6600),r=l(9320),d=l(3442);function c(e){let{options:t,value:l,onChange:s,className:o=""}=e;return(0,a.jsx)("div",{role:"group",className:"inline-flex items-center rounded-full bg-slate-100 p-1 text-sm shadow-inner ".concat(o?" ".concat(o):""),children:t.map(e=>{let t=l===e.id;return(0,a.jsx)("button",{type:"button",onClick:()=>s(e.id),className:"rounded-full px-4 py-1.5 text-sm font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-violet-300 focus-visible:ring-offset-2 ".concat(t?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"),children:e.label},e.id)})})}function u(e){return new Date("".concat(e,"T00:00:00"))}function m(e){let t=new Date(e);return t.setHours(0,0,0,0),t}function x(e){var t;let l=function(e,t){let l=m(e).getTime();return Math.round((m(t).getTime()-l)/864e5)}(m(new Date),m(u(e.outage_date))),a=l<0?"เลยกำหนด ".concat(Math.abs(l)," วัน"):0===l?"วันนี้":1===l?"พรุ่งนี้":"เหลือ ".concat(l," วัน");return l<0?{daysLeft:l,color:"RED",label:a}:"PENDING"===(null!==(t=e.nakhon_status)&&void 0!==t?t:"PENDING")?l<14?{daysLeft:l,color:"RED",label:a}:l<=28?{daysLeft:l,color:"YELLOW",label:a}:{daysLeft:l,color:"GREEN",label:a}:l<3?{daysLeft:l,color:"RED",label:a}:l<=6?{daysLeft:l,color:"YELLOW",label:a}:{daysLeft:l,color:"GREEN",label:a}}let p=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"];function _(e){var t,l,a,s,o,n;let i=null!==(t=e.doc_purpose)&&void 0!==t?t:"",r=null!==(l=e.doc_area_title)&&void 0!==l?l:"",d=null!==(a=e.doc_time_start)&&void 0!==a?a:"",c=null!==(s=e.doc_time_end)&&void 0!==s?s:"",m=null!==(o=e.doc_area_detail)&&void 0!==o?o:"",x=null!==(n=e.map_link)&&void 0!==n?n:"",_=function(e){var t;if(!e)return"";let l=u(e),a=l.getDate(),s=null!==(t=p[l.getMonth()])&&void 0!==t?t:"",o=l.getFullYear()+543;return"".concat(a," ").concat(s," ").concat(o).trim()}(e.outage_date);return["เพื่อ".concat(i," บริเวณ ").concat(r),"\uD83D\uDCC5".concat(_),"☣️โซนสีเหลือง แสดงพื้นที่ไฟดับ ตั้งแต่เวลา ".concat(d," .- ").concat(c," น."),"\uD83C\uDF0Fบริเวณพื้นที่ผู้ใช้ไฟได้รับผลกระทบ ".concat(m),"\uD83D\uDCCCกดลิ้งค์ \uD83D\uDC47 เพื่อตรวจสอบพื้นที่ไฟดับ ".concat(x)].join("\n")}function b(e){let{job:t,isOpen:l,onClose:s,onJobUpdate:o}=e,[d,c]=(0,n.useState)(!1),[u,m]=(0,n.useState)(null),x=(0,n.useMemo)(()=>{var e;return t?(null===(e=t.social_post_text)||void 0===e?void 0:e.trim())?t.social_post_text:_(t):""},[t]);(0,n.useEffect)(()=>{if(!u)return;let e=window.setTimeout(()=>{m(null)},3e3);return()=>window.clearTimeout(e)},[u]);let p=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];if(x)try{await navigator.clipboard.writeText(x),e&&m("คัดลอกข้อความแล้ว — ไปวางใน Facebook/LINE ได้เลย")}catch(t){console.error("Failed to copy text",t),e&&m("คัดลอกข้อความไม่สำเร็จ กรุณาลองใหม่")}},b=async()=>{if(t&&x){if("POSTED"===t.social_status){await p();return}c(!0);try{var e,l,a,n,i,r;let d=await fetch("/api/jobs/social-post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:t.id})}),c=await d.json().catch(()=>null);if(!d.ok||!(null==c?void 0:c.ok))throw Error(null!==(e=null==c?void 0:c.error)&&void 0!==e?e:"ไม่สามารถโพสต์ข้อความได้");let u=null!==(l=c.social_posted_at)&&void 0!==l?l:new Date().toISOString(),x=null!==(n=null!==(a=c.social_post_text)&&void 0!==a?a:c.preview_text)&&void 0!==n?n:_(t);o(t.id,{...null!==(i=c.job)&&void 0!==i?i:{},social_status:null!==(r=c.social_status)&&void 0!==r?r:"POSTED",social_post_text:x,social_posted_at:u}),p(!1),m("โพสต์ข้อความสำเร็จแล้ว"),window.setTimeout(()=>{s()},500)}catch(e){console.error("Social post failed",e),m("โพสต์ข้อความไม่สำเร็จ กรุณาลองใหม่")}finally{c(!1)}}};return(0,a.jsx)(r.Z,{isOpen:l,title:"ตัวอย่างข้อความโพสต์ Social",onClose:s,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[u?(0,a.jsx)("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:u}):null,(0,a.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-3 text-sm text-slate-700",children:(0,a.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed",children:x||"-"})}),(0,a.jsx)("div",{className:"rounded-xl border border-slate-200 bg-white p-3",children:(0,a.jsx)(i.Z,{googleUrl:null==t?void 0:t.map_link,myMapUrl:null==t?void 0:t.mymaps_url})}),(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>void p(!0),className:"rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100",children:"คัดลอกข้อความ"}),(0,a.jsx)("button",{type:"button",onClick:b,disabled:d||!x,className:"rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:d?"กำลังโพสต์...":"Post ลงสื่อ social"})]})]})})}let h="rounded-2xl border border-slate-200/60 bg-white/80 shadow-sm transition hover:shadow-md",f="text-white bg-gradient-to-r from-violet-600 via-purple-600 to-indigo-600 shadow-[0_10px_24px_rgba(124,58,237,0.25)] hover:brightness-110 active:scale-[0.98] focus-visible:ring-violet-300",g="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 ".concat(f),v="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-slate-100/60 px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-violet-300 focus-visible:ring-offset-2",j="rounded-xl border border-slate-200/80 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm outline-none transition focus:border-purple-400 focus-visible:ring-2 focus-visible:ring-purple-200",N=e=>{switch(e){case"RED":return"border border-rose-200/80 bg-rose-50 text-rose-700";case"YELLOW":return"border border-amber-200/80 bg-amber-50 text-amber-700";default:return"border border-emerald-200/80 bg-emerald-50 text-emerald-700"}};function w(e){let{status:t,label:l}=e;return(0,a.jsx)("span",{className:"rounded-full px-3 py-1 text-xs font-semibold ".concat(N(t)),children:l})}var y=l(1707),k=l(3866);let E=e=>{var t;if(!e)return null;let l=e.match(/filename\*=UTF-8''([^;]+)/i);if(null==l?void 0:l[1])try{return decodeURIComponent(l[1])}catch(e){return l[1]}let a=e.match(/filename="?([^";]+)"?/i);return null!==(t=null==a?void 0:a[1])&&void 0!==t?t:null},D=e=>{var t,l,a;if("PENDING"===(null!==(t=e.nakhon_status)&&void 0!==t?t:"PENDING"))return"notify_nakhon";if(!("GENERATED"===e.doc_status||e.doc_generated_at))return"create_doc";let s=null!==(l=e.social_status)&&void 0!==l?l:"DRAFT";if("PENDING_APPROVAL"===s)return"wait_approval";let o=null!==(a=e.notice_status)&&void 0!==a?a:"NONE";return"POSTED"===s&&"SCHEDULED"!==o?"notify_outage_letter":"close_job"},C={notify_nakhon:"แจ้งศูนย์นคร",create_doc:"สร้างเอกสารดับไฟ",wait_approval:"รออนุมัติ",notify_outage_letter:"แจ้งหนังสือดับไฟ",close_job:"ปิดงาน"},S="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",O="".concat(S," ").concat(f),T="".concat(S," border border-slate-200 bg-white text-slate-700 hover:bg-slate-50 focus-visible:ring-slate-200"),P="disabled:cursor-not-allowed disabled:opacity-60";function L(){let e=(0,o.useRouter)(),[t,l]=(0,n.useState)([]),[m,p]=(0,n.useState)(!0),[_,f]=(0,n.useState)(null),[N,S]=(0,n.useState)(""),[L,R]=(0,n.useState)("all"),[I,U]=(0,n.useState)("active"),[G,F]=(0,n.useState)(null),[A,q]=(0,n.useState)({}),[Z,H]=(0,n.useState)(null),[M,J]=(0,n.useState)(""),[Y,W]=(0,n.useState)(""),[Q,V]=(0,n.useState)({}),[K,z]=(0,n.useState)(!1),[B,X]=(0,n.useState)(null),[$,ee]=(0,n.useState)(null),[et,el]=(0,n.useState)(null),[ea,es]=(0,n.useState)({doc_issue_date:"",doc_purpose:"",doc_area_title:"",doc_time_start:"",doc_time_end:"",doc_area_detail:"",map_link:""}),[eo,en]=(0,n.useState)({}),[ei,er]=(0,n.useState)(!1),[ed,ec]=(0,n.useState)(null),[eu,em]=(0,n.useState)(!1),[ex,ep]=(0,n.useState)(null),[e_,eb]=(0,n.useState)(null),[eh,ef]=(0,n.useState)(null),eg=async()=>{p(!0),f(null),F(null);let{data:e,error:t}=await (0,y.DQ)();t?(f(t.message),l([])):l(null!=e?e:[]),p(!1)};(0,n.useEffect)(()=>{eg()},[]),(0,n.useEffect)(()=>{(async()=>{var e,t;let{data:l}=await k.O.auth.getUser();ef(null!==(t=null===(e=l.user)||void 0===e?void 0:e.email)&&void 0!==t?t:null)})();let{data:e}=k.O.auth.onAuthStateChange((e,t)=>{var l,a;ef(null!==(a=null==t?void 0:null===(l=t.user)||void 0===l?void 0:l.email)&&void 0!==a?a:null)});return()=>{e.subscription.unsubscribe()}},[]),(0,n.useEffect)(()=>{if(!e_)return;let e=window.setTimeout(()=>{eb(null)},2e3);return()=>window.clearTimeout(e)},[e_]);let ev=()=>{H(null),J(""),W(""),V({}),z(!1)},ej=()=>{X(null),es({doc_issue_date:"",doc_purpose:"",doc_area_title:"",doc_time_start:"",doc_time_end:"",doc_area_detail:"",map_link:""}),en({}),er(!1)},eN=()=>{el(null)},ew=e=>{H(e),J(""),W(""),V({})},ey=e=>{var t,l,a,s,o,n,i;X(e),es({doc_issue_date:null!==(t=e.doc_issue_date)&&void 0!==t?t:"",doc_purpose:null!==(l=e.doc_purpose)&&void 0!==l?l:"",doc_area_title:null!==(a=e.doc_area_title)&&void 0!==a?a:"",doc_time_start:null!==(s=e.doc_time_start)&&void 0!==s?s:"",doc_time_end:null!==(o=e.doc_time_end)&&void 0!==o?o:"",doc_area_detail:null!==(n=e.doc_area_detail)&&void 0!==n?n:"",map_link:null!==(i=e.map_link)&&void 0!==i?i:""}),en({})},ek=e=>{ec(e),em(!1),ep(null)},eE=async()=>{if(!ed)return;em(!0),ep(null);let{data:t}=await k.O.auth.getSession();if(!t.session){em(!1),ec(null),e.push("/login");return}try{let t=await fetch("/api/jobs/".concat(ed.id,"/close"),{method:"POST",headers:{"Content-Type":"application/json"}});if(401===t.status){em(!1),ec(null),e.push("/login");return}let a=await t.json().catch(()=>null);if(!t.ok||!(null==a?void 0:a.ok)){var l;throw Error(null!==(l=null==a?void 0:a.error)&&void 0!==l?l:"ปิดงานไม่สำเร็จ กรุณาลองใหม่")}eb({message:"✅ ปิดงานเรียบร้อย",tone:"success"}),await eg(),ec(null)}catch(t){let e=t instanceof Error?t.message:"ปิดงานไม่สำเร็จ กรุณาลองใหม่";ep(e),eb({message:e,tone:"error"})}finally{em(!1)}},eD=async()=>{await k.O.auth.signOut(),await fetch("/api/auth/session",{method:"DELETE"}),e.push("/login")},eC=async()=>{if(!Z)return;let e={};if(M||(e.date="กรุณาระบุวันที่แจ้งศูนย์นคร"),Y.trim()||(e.memoNo="กรุณาระบุเลขที่บันทึก"),Object.keys(e).length>0){V(e);return}z(!0),V({});let{error:t}=await (0,y.Z6)(Z.id,{date:M,memoNo:Y.trim()});if(t){V({submit:t.message||"บันทึกไม่สำเร็จ กรุณาลองใหม่"}),z(!1);return}l(e=>e.map(e=>e.id===Z.id?{...e,nakhon_status:"NOTIFIED",nakhon_notified_date:M,nakhon_memo_no:Y.trim()}:e)),ev()},eS=async e=>{F(null),q(t=>({...t,[e.id]:!0}));let{error:t}=await (0,y.uA)(e.id);if(t){F(t.message||"อัปเดตไม่สำเร็จ"),q(t=>({...t,[e.id]:!1}));return}l(t=>t.map(t=>t.id===e.id?{...t,nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}:t)),q(t=>({...t,[e.id]:!1}))},eO=async()=>{if(!B)return;let e={};if(ea.doc_issue_date||(e.doc_issue_date="กรุณาระบุวันที่ออกหนังสือ"),ea.doc_purpose.trim()||(e.doc_purpose="กรุณาระบุวัตถุประสงค์"),ea.doc_area_title.trim()||(e.doc_area_title="กรุณาระบุบริเวณที่ดับ"),ea.doc_time_start.trim()||(e.doc_time_start="กรุณาระบุเวลาเริ่มดับไฟ"),ea.doc_time_end.trim()||(e.doc_time_end="กรุณาระบุเวลาจ่ายไฟ"),ea.doc_area_detail.trim()||(e.doc_area_detail="กรุณาระบุรายละเอียดพื้นที่ดับไฟ"),ea.map_link.trim()||(e.map_link="กรุณาระบุลิ้ง google map"),Object.keys(e).length>0){en(e);return}let t={doc_issue_date:ea.doc_issue_date,doc_purpose:ea.doc_purpose.trim(),doc_area_title:ea.doc_area_title.trim(),doc_time_start:ea.doc_time_start.trim(),doc_time_end:ea.doc_time_end.trim(),doc_area_detail:ea.doc_area_detail.trim(),map_link:ea.map_link.trim()};er(!0),en({});try{var a,s;let e=await fetch("/api/docs/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:B.id,payload:t})});if(!e.ok){let t=null!==(a=e.headers.get("Content-Type"))&&void 0!==a?a:"",l="";if(t.includes("application/json")){let t=await e.json().catch(()=>null);l=(null==t?void 0:t.error)||(null==t?void 0:t.message)||""}else l=await e.text().catch(()=>"");en({submit:l?"ไม่สามารถสร้างเอกสารได้ กรุณาลองใหม่ (".concat(l,")"):"ไม่สามารถสร้างเอกสารได้ กรุณาลองใหม่"}),er(!1);return}let o=await e.blob(),n=window.URL.createObjectURL(o),i=null!==(s=E(e.headers.get("Content-Disposition")))&&void 0!==s?s:"outage-doc-".concat(B.id,".docx"),r=document.createElement("a");r.href=n,r.download=i,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(n);let d=new Date().toISOString();l(e=>e.map(e=>e.id===B.id?{...e,...t,doc_status:"GENERATED",doc_url:null,doc_generated_at:d}:e));try{let e=await fetch("/api/jobs/social-pending",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:B.id})}),t=await e.json().catch(()=>null);e.ok&&(null==t?void 0:t.ok)?l(e=>e.map(e=>e.id===B.id?{...e,social_status:"PENDING_APPROVAL"}:e)):console.warn("Failed to set social pending status",t)}catch(e){console.warn("Failed to set social pending status",e)}ej()}catch(e){console.error(e),en({submit:"สร้างเอกสารไม่สำเร็จ กรุณาลองใหม่"}),er(!1)}},eT=(0,n.useMemo)(()=>{let e=N.trim().toLowerCase();return t.filter(e=>"closed"===I?e.is_closed:!e.is_closed).filter(t=>!e||t.equipment_code.toLowerCase().includes(e)).filter(e=>"all"===L||x(e).color.toLowerCase()===L).sort((e,t)=>{if("closed"===I){let l=e.closed_at?new Date(e.closed_at).getTime():0;return(t.closed_at?new Date(t.closed_at).getTime():0)-l}return u(e.outage_date).getTime()-u(t.outage_date).getTime()})},[t,N,L,I]);return(0,a.jsx)("div",{className:"min-h-screen bg-slate-50",children:(0,a.jsxs)("div",{className:"mx-auto flex w-full max-w-5xl flex-col gap-6 px-4 py-8 sm:px-6 lg:px-8",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-5 rounded-2xl border border-slate-200/60 bg-white/80 p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900",children:"Krabi Outage Tracker"}),(0,a.jsx)("p",{className:"text-sm text-slate-500",children:"ติดตามงานดับไฟตามกำหนดและสถานะวันคงเหลือ"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-start gap-3 sm:items-end",children:[eh?(0,a.jsx)("span",{className:"text-xs font-medium text-slate-500",children:eh}):null,(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,a.jsx)(s.default,{href:"/new",className:g,children:"+ สร้างงาน"}),(0,a.jsx)("button",{type:"button",onClick:eD,className:v,children:"ออกจากระบบ"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between",children:[(0,a.jsxs)("div",{className:"flex w-full max-w-md flex-col gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-slate-600",children:"ค้นหาอุปกรณ์"}),(0,a.jsx)("input",{value:N,onChange:e=>S(e.target.value),placeholder:"กรอกรหัสอุปกรณ์",className:j})]}),(0,a.jsx)(c,{options:[{id:"all",label:"ทั้งหมด"},{id:"green",label:"เขียว"},{id:"yellow",label:"เหลือง"},{id:"red",label:"แดง"}],value:L,onChange:R})]}),(0,a.jsx)(c,{options:[{id:"active",label:"กำลังดำเนินการ"},{id:"closed",label:"ปิดแล้ว"}],value:I,onChange:U})]}),e_?(0,a.jsx)("div",{className:"rounded-xl border px-4 py-3 text-sm ".concat("success"===e_.tone?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-rose-200 bg-rose-50 text-rose-700"),children:e_.message}):null,_?(0,a.jsx)("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700",children:_}):null,G?(0,a.jsx)("div",{className:"rounded-xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-700",children:G}):null,(0,a.jsx)("section",{className:"grid gap-4",children:m?(0,a.jsx)("div",{className:"".concat(h," px-4 py-8 text-center text-sm text-slate-500"),children:"กำลังโหลดข้อมูล..."}):0===eT.length?(0,a.jsx)("div",{className:"".concat(h," px-4 py-8 text-center text-sm text-slate-500"),children:"ยังไม่มีงานที่ตรงกับตัวกรอง"}):eT.map(t=>{var l,s,o,n,r,d,c,m;let p=x(t),_="RED"===(m=p.color)?{strip:"bg-rose-200/80",badge:"border border-rose-200/80 bg-rose-50 text-rose-700",text:"text-rose-700"}:"YELLOW"===m?{strip:"bg-amber-200/80",badge:"border border-amber-200/80 bg-amber-50 text-amber-700",text:"text-amber-700"}:{strip:"bg-emerald-200/80",badge:"border border-emerald-200/80 bg-emerald-50 text-emerald-700",text:"text-emerald-700"},b=null!==(s=t.nakhon_status)&&void 0!==s?s:"PENDING",f="NOTIFIED"===b,g=null!==(o=A[t.id])&&void 0!==o&&o,v=null!==(n=t.is_closed)&&void 0!==n&&n,j="GENERATED"===t.doc_status||!!t.doc_generated_at,N="GENERATING"===t.doc_status,y=null!==(r=t.social_status)&&void 0!==r?r:"DRAFT",k=null!==(d=t.notice_status)&&void 0!==d?d:"NONE",E=D(t),S=C[E],L=e=>e===E?O:T;return(0,a.jsxs)("div",{className:"".concat(h," group flex items-stretch overflow-hidden transition hover:-translate-y-0.5"),children:[(0,a.jsx)("div",{className:"w-2 ".concat(_.strip)}),(0,a.jsxs)("div",{className:"flex w-full flex-col gap-4 p-5 sm:flex-row sm:items-start sm:justify-between",children:[(0,a.jsxs)("div",{className:"flex min-w-[240px] flex-1 flex-col gap-4",children:[(0,a.jsxs)("div",{role:"button",tabIndex:0,onClick:()=>e.push("/job/".concat(t.id)),onKeyDown:l=>{("Enter"===l.key||" "===l.key)&&(l.preventDefault(),e.push("/job/".concat(t.id)))},className:"cursor-pointer space-y-4 rounded-2xl outline-none transition focus-visible:ring-2 focus-visible:ring-purple-400 focus-visible:ring-offset-2",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("span",{className:"text-sm text-slate-500",children:u(t.outage_date).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})}),(0,a.jsx)("span",{className:"text-sm font-medium ".concat(_.text),children:p.label})]}),(0,a.jsx)(w,{status:p.color,label:p.color})]}),v?(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs font-medium text-slate-600",children:[(0,a.jsx)("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-700",children:"ปิดแล้ว"}),(0,a.jsxs)("span",{children:["ปิดเมื่อ"," ",t.closed_at?new Date(t.closed_at).toLocaleString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"]})]}):null,(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-lg font-semibold tracking-tight text-slate-900",children:t.equipment_code}),(0,a.jsx)("p",{className:"text-sm text-slate-600",children:(null===(l=t.note)||void 0===l?void 0:l.trim())||"ไม่มีหมายเหตุ"})]}),(f||"NOT_REQUIRED"===b)&&(0,a.jsx)("div",{className:"text-sm text-slate-600",children:f?(0,a.jsxs)(a.Fragment,{children:["แจ้งศูนย์นครแล้ว:"," ",(0,a.jsx)("span",{className:"font-medium text-slate-800",children:t.nakhon_notified_date?u(t.nakhon_notified_date).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"}):"-"})," ","| เลขที่บันทึก:"," ",(0,a.jsx)("span",{className:"font-medium text-slate-800",children:null!==(c=t.nakhon_memo_no)&&void 0!==c?c:"-"})]}):(0,a.jsx)("span",{children:"ไม่ต้องแจ้งศูนย์นคร"})})]}),(0,a.jsx)(i.Z,{googleUrl:t.map_link,myMapUrl:t.mymaps_url})]}),v?null:(0,a.jsxs)("div",{className:"flex w-full flex-col items-stretch gap-2 sm:w-auto sm:min-w-[220px]",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-slate-500",children:["ขั้นตอนถัดไป:"," ",(0,a.jsx)("span",{className:"text-slate-700",children:S})]}),"PENDING"===b?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{type:"button",onClick:()=>ew(t),className:L("notify_nakhon"),children:"แจ้งศูนย์นครแล้ว"}),(0,a.jsx)("button",{type:"button",onClick:()=>eS(t),disabled:g,className:"".concat(T," ").concat(P),children:g?"กำลังบันทึก...":"ไม่ต้องแจ้งศูนย์นคร"})]}):(0,a.jsx)(a.Fragment,{children:j?t.doc_url?(0,a.jsx)("button",{type:"button",onClick:()=>{if(t.doc_url){window.open(t.doc_url,"_blank","noopener,noreferrer");return}ey(t)},className:L("create_doc"),children:"พิมพ์เอกสาร"}):(0,a.jsx)("button",{type:"button",onClick:()=>ey(t),className:T,children:"ดาวน์โหลดเอกสารอีกครั้ง"}):(0,a.jsx)("button",{type:"button",onClick:()=>ey(t),disabled:g||N,className:"".concat(L("create_doc")," ").concat(P),children:N?"กำลังสร้าง...":"สร้างเอกสารดับไฟ"})}),"PENDING_APPROVAL"===y||"POSTED"===y?(0,a.jsx)("button",{type:"button",onClick:()=>ee(t),className:L("wait_approval"),children:"POSTED"===y?"Posted แล้วสื่อ Social":"รออนุมัติ"}):null,"POSTED"===y?(0,a.jsx)("button",{type:"button",onClick:()=>el(t),className:L("notify_outage_letter"),children:"SCHEDULED"===k?"กำหนดการแจ้งเรียบร้อยแล้ว (แก้ไขได้)":"แจ้งหนังสือดับไฟ"}):null,"SCHEDULED"!==k||v?null:(0,a.jsx)("button",{type:"button",onClick:()=>ek(t),className:L("close_job"),children:"ปิดงาน"})]})]})]},t.id)})}),(0,a.jsx)(r.Z,{isOpen:!!Z,title:"แจ้งศูนย์นครแล้ว",onClose:ev,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["วันที่แจ้งศูนย์นคร",(0,a.jsx)("input",{type:"date",value:M,onChange:e=>J(e.target.value),className:j,required:!0}),Q.date?(0,a.jsx)("span",{className:"text-xs text-red-600",children:Q.date}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["เลขที่บันทึก",(0,a.jsx)("input",{type:"text",value:Y,onChange:e=>W(e.target.value),className:j,required:!0}),Q.memoNo?(0,a.jsx)("span",{className:"text-xs text-red-600",children:Q.memoNo}):null]}),Q.submit?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:Q.submit}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:ev,className:v,children:"ยกเลิก"}),(0,a.jsx)("button",{type:"button",onClick:eC,disabled:K,className:"".concat(g," disabled:cursor-not-allowed disabled:opacity-70"),children:K?"กำลังบันทึก...":"ตกลง"})]})]})}),(0,a.jsx)(r.Z,{isOpen:!!B,title:"สร้างเอกสารดับไฟ",onClose:ej,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["หนังสือลงวันที่",(0,a.jsx)("input",{type:"date",value:ea.doc_issue_date,onChange:e=>es(t=>({...t,doc_issue_date:e.target.value})),className:j,required:!0}),eo.doc_issue_date?(0,a.jsx)("span",{className:"text-xs text-red-600",children:eo.doc_issue_date}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["ดับไฟเพื่อ",(0,a.jsx)("input",{type:"text",value:ea.doc_purpose,onChange:e=>es(t=>({...t,doc_purpose:e.target.value})),className:j,required:!0}),eo.doc_purpose?(0,a.jsx)("span",{className:"text-xs text-red-600",children:eo.doc_purpose}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["บริเวณที่ดับ",(0,a.jsx)("input",{type:"text",value:ea.doc_area_title,onChange:e=>es(t=>({...t,doc_area_title:e.target.value})),className:j,required:!0}),eo.doc_area_title?(0,a.jsx)("span",{className:"text-xs text-red-600",children:eo.doc_area_title}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["เวลาเริ่มดับไฟ",(0,a.jsx)("input",{type:"time",value:ea.doc_time_start,onChange:e=>es(t=>({...t,doc_time_start:e.target.value})),className:j,required:!0}),eo.doc_time_start?(0,a.jsx)("span",{className:"text-xs text-red-600",children:eo.doc_time_start}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["เวลาจ่ายไฟ",(0,a.jsx)("input",{type:"time",value:ea.doc_time_end,onChange:e=>es(t=>({...t,doc_time_end:e.target.value})),className:j,required:!0}),eo.doc_time_end?(0,a.jsx)("span",{className:"text-xs text-red-600",children:eo.doc_time_end}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["รายละเอียดพื้นที่ดับไฟ",(0,a.jsx)("textarea",{value:ea.doc_area_detail,onChange:e=>es(t=>({...t,doc_area_detail:e.target.value})),rows:3,className:j,required:!0}),eo.doc_area_detail?(0,a.jsx)("span",{className:"text-xs text-red-600",children:eo.doc_area_detail}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["ลิ้ง google map",(0,a.jsx)("input",{type:"url",value:ea.map_link,onChange:e=>es(t=>({...t,map_link:e.target.value})),className:j,required:!0}),eo.map_link?(0,a.jsx)("span",{className:"text-xs text-red-600",children:eo.map_link}):null]}),eo.submit?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:eo.submit}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:ej,className:v,children:"ยกเลิก"}),(0,a.jsx)("button",{type:"button",onClick:eO,disabled:ei,className:"".concat(g," disabled:cursor-not-allowed disabled:opacity-70"),children:ei?"กำลังสร้าง...":"สร้าง"})]})]})}),(0,a.jsx)(b,{job:$,isOpen:!!$,onClose:()=>{ee(null)},onJobUpdate:(e,t)=>{l(l=>l.map(l=>l.id===e?{...l,...t}:l)),ee(l=>(null==l?void 0:l.id)===e?{...l,...t}:l)}}),(0,a.jsx)(d.Z,{job:et,open:!!et,onOpenChange:e=>{e||eN()},onJobUpdate:(e,t)=>{l(l=>l.map(l=>l.id===e?{...l,...t}:l)),el(l=>(null==l?void 0:l.id)===e?{...l,...t}:l)}}),(0,a.jsx)(r.Z,{isOpen:!!ed,title:"ยืนยันปิดงาน?",onClose:()=>ec(null),children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)("p",{className:"text-sm text-slate-600",children:'ปิดงานแล้วจะถูกย้ายไปที่ "งานที่ปิดแล้ว" และไม่สามารถแก้ไขได้'}),ex?(0,a.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:ex}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:()=>ec(null),className:v,children:"ยกเลิก"}),(0,a.jsx)("button",{type:"button",onClick:eE,disabled:eu,className:"".concat(g," disabled:cursor-not-allowed disabled:opacity-70"),children:eu?"กำลังปิดงาน...":"ยืนยันปิดงาน"})]})]})})]})})}}}]);