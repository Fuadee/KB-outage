exports.id=845,exports.ids=[845],exports.modules={519:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},6215:()=>{},2642:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>C});var a=s(326),l=s(434),o=s(5047),n=s(7577),r=s(8168),i=s(7687),d=s(9068);function c({options:e,value:t,onChange:s,className:l=""}){return a.jsx("div",{role:"group",className:`inline-flex items-center rounded-full bg-slate-100 p-1 text-sm shadow-inner ${l?` ${l}`:""}`,children:e.map(e=>{let l=t===e.id;return a.jsx("button",{type:"button",onClick:()=>s(e.id),className:`rounded-full px-4 py-1.5 text-sm font-medium transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-violet-300 focus-visible:ring-offset-2 ${l?"bg-white text-slate-900 shadow-sm":"text-slate-600 hover:text-slate-900"}`,children:e.label},e.id)})})}function u(e){return new Date(`${e}T00:00:00`)}function m(e){let t=new Date(e);return t.setHours(0,0,0,0),t}function x(e){let t=function(e,t){let s=m(e).getTime();return Math.round((m(t).getTime()-s)/864e5)}(m(new Date),m(u(e.outage_date))),s=t<0?`à¹€à¸¥à¸¢à¸à¸³à¸«à¸™à¸” ${Math.abs(t)} à¸§à¸±à¸™`:0===t?"à¸§à¸±à¸™à¸™à¸µà¹‰":1===t?"à¸žà¸£à¸¸à¹ˆà¸‡à¸™à¸µà¹‰":`à¹€à¸«à¸¥à¸·à¸­ ${t} à¸§à¸±à¸™`;return t<0?{daysLeft:t,color:"RED",label:s}:"PENDING"===(e.nakhon_status??"PENDING")?t<14?{daysLeft:t,color:"RED",label:s}:t<=28?{daysLeft:t,color:"YELLOW",label:s}:{daysLeft:t,color:"GREEN",label:s}:t<3?{daysLeft:t,color:"RED",label:s}:t<=6?{daysLeft:t,color:"YELLOW",label:s}:{daysLeft:t,color:"GREEN",label:s}}let p=["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸žà¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸žà¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸Žà¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸žà¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"];function h(e){let t=e.doc_purpose??"",s=e.doc_area_title??"",a=e.doc_time_start??"",l=e.doc_time_end??"",o=e.doc_area_detail??"",n=e.map_link??"",r=function(e){if(!e)return"";let t=u(e),s=t.getDate(),a=p[t.getMonth()]??"",l=t.getFullYear()+543;return`${s} ${a} ${l}`.trim()}(e.outage_date);return`à¹€à¸žà¸·à¹ˆà¸­${t} à¸šà¸£à¸´à¹€à¸§à¸“ ${s}
ðŸ“…${r}
â˜£ï¸à¹‚à¸‹à¸™à¸ªà¸µà¹€à¸«à¸¥à¸·à¸­à¸‡ à¹à¸ªà¸”à¸‡à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¹„à¸Ÿà¸”à¸±à¸š à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¹€à¸§à¸¥à¸² ${a} .- ${l} à¸™.
ðŸŒà¸šà¸£à¸´à¹€à¸§à¸“à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹„à¸Ÿà¹„à¸”à¹‰à¸£à¸±à¸šà¸œà¸¥à¸à¸£à¸°à¸—à¸š ${o}
ðŸ“Œà¸à¸”à¸¥à¸´à¹‰à¸‡à¸„à¹Œ ðŸ‘‡ à¹€à¸žà¸·à¹ˆà¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¹„à¸Ÿà¸”à¸±à¸š ${n}`}function _({job:e,isOpen:t,onClose:s,onJobUpdate:l}){let[o,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null),m=(0,n.useMemo)(()=>e?e.social_post_text?.trim()?e.social_post_text:h(e):"",[e]),x=async(e=!0)=>{if(m)try{await navigator.clipboard.writeText(m),e&&u("à¸„à¸±à¸”à¸¥à¸­à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹à¸¥à¹‰à¸§ â€” à¹„à¸›à¸§à¸²à¸‡à¹ƒà¸™ Facebook/LINE à¹„à¸”à¹‰à¹€à¸¥à¸¢")}catch(t){console.error("Failed to copy text",t),e&&u("à¸„à¸±à¸”à¸¥à¸­à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ")}},p=async()=>{if(e&&m){if("POSTED"===e.social_status){await x();return}d(!0);try{let t=await fetch("/api/jobs/social-post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:e.id})}),a=await t.json().catch(()=>null);if(!t.ok||!a?.ok)throw Error(a?.error??"à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸žà¸ªà¸•à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹„à¸”à¹‰");let o=a.social_posted_at??new Date().toISOString(),n=a.social_post_text??a.preview_text??h(e);l(e.id,{...a.job??{},social_status:a.social_status??"POSTED",social_post_text:n,social_posted_at:o}),x(!1),u("à¹‚à¸žà¸ªà¸•à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§"),window.setTimeout(()=>{s()},500)}catch(e){console.error("Social post failed",e),u("à¹‚à¸žà¸ªà¸•à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ")}finally{d(!1)}}};return a.jsx(i.Z,{isOpen:t,title:"à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹‚à¸žà¸ªà¸•à¹Œ Social",onClose:s,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[c?a.jsx("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:c}):null,a.jsx("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-3 text-sm text-slate-700",children:a.jsx("p",{className:"whitespace-pre-wrap leading-relaxed",children:m||"-"})}),a.jsx("div",{className:"rounded-xl border border-slate-200 bg-white p-3",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1 text-xs text-slate-500",children:[a.jsx("span",{children:"à¸¥à¸´à¹‰à¸‡ Google Map"}),a.jsx(r.Z,{url:e?.map_link??void 0,label:"à¹€à¸›à¸´à¸” Google Map"})]})}),(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:()=>void x(!0),className:"rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100",children:"à¸„à¸±à¸”à¸¥à¸­à¸à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡"}),a.jsx("button",{type:"button",onClick:p,disabled:o||!m,className:"rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:o?"à¸à¸³à¸¥à¸±à¸‡à¹‚à¸žà¸ªà¸•à¹Œ...":"Post à¸¥à¸‡à¸ªà¸·à¹ˆà¸­ social"})]})]})})}var b=s(3217);function f({status:e,label:t}){return a.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${(0,b.cS)(e)}`,children:t})}var g=s(8927),j=s(1632);let N=e=>{if(!e)return null;let t=e.match(/filename\*=UTF-8''([^;]+)/i);if(t?.[1])try{return decodeURIComponent(t[1])}catch{return t[1]}let s=e.match(/filename="?([^";]+)"?/i);return s?.[1]??null},y=e=>{if("PENDING"===(e.nakhon_status??"PENDING"))return"notify_nakhon";if(!("GENERATED"===e.doc_status||e.doc_generated_at))return"create_doc";let t=e.social_status??"DRAFT";if("PENDING_APPROVAL"===t)return"wait_approval";let s=e.notice_status??"NONE";return"POSTED"===t&&"SCHEDULED"!==s?"notify_outage_letter":"close_job"},v={notify_nakhon:"à¹à¸ˆà¹‰à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸™à¸„à¸£",create_doc:"à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸à¸ªà¸²à¸£à¸”à¸±à¸šà¹„à¸Ÿ",wait_approval:"à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´",notify_outage_letter:"à¹à¸ˆà¹‰à¸‡à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸”à¸±à¸šà¹„à¸Ÿ",close_job:"à¸›à¸´à¸”à¸‡à¸²à¸™"},w="inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",k=`${w} ${b.uI}`,S=`${w} border border-slate-200 bg-white text-slate-700 hover:bg-slate-50 focus-visible:ring-slate-200`,E="disabled:cursor-not-allowed disabled:opacity-60";function C(){let e=(0,o.useRouter)(),[t,s]=(0,n.useState)([]),[m,p]=(0,n.useState)(!0),[h,w]=(0,n.useState)(null),[C,D]=(0,n.useState)(""),[O,T]=(0,n.useState)("all"),[$,P]=(0,n.useState)("active"),[L,I]=(0,n.useState)(null),[R,U]=(0,n.useState)({}),[q,G]=(0,n.useState)(null),[A,M]=(0,n.useState)(""),[F,X]=(0,n.useState)(""),[Z,Y]=(0,n.useState)({}),[K,H]=(0,n.useState)(!1),[B,J]=(0,n.useState)(null),[W,Q]=(0,n.useState)(null),[V,z]=(0,n.useState)(null),[ee,et]=(0,n.useState)({doc_issue_date:"",doc_purpose:"",doc_area_title:"",doc_time_start:"",doc_time_end:"",doc_area_detail:"",map_link:""}),[es,ea]=(0,n.useState)({}),[el,eo]=(0,n.useState)(!1),[en,er]=(0,n.useState)(null),[ei,ed]=(0,n.useState)(!1),[ec,eu]=(0,n.useState)(null),[em,ex]=(0,n.useState)(null),[ep,eh]=(0,n.useState)(null),e_=async()=>{p(!0),w(null),I(null);let{data:e,error:t}=await (0,g.DQ)();t?(w(t.message),s([])):s(e??[]),p(!1)},eb=()=>{G(null),M(""),X(""),Y({}),H(!1)},ef=()=>{J(null),et({doc_issue_date:"",doc_purpose:"",doc_area_title:"",doc_time_start:"",doc_time_end:"",doc_area_detail:"",map_link:""}),ea({}),eo(!1)},eg=()=>{z(null)},ej=e=>{G(e),M(""),X(""),Y({})},eN=e=>{J(e),et({doc_issue_date:e.doc_issue_date??"",doc_purpose:e.doc_purpose??"",doc_area_title:e.doc_area_title??"",doc_time_start:e.doc_time_start??"",doc_time_end:e.doc_time_end??"",doc_area_detail:e.doc_area_detail??"",map_link:e.map_link??""}),ea({})},ey=e=>{er(e),ed(!1),eu(null)},ev=async()=>{if(!en)return;ed(!0),eu(null);let{data:t}=await j.O.auth.getSession();if(!t.session){ed(!1),er(null),e.push("/login");return}try{let t=await fetch(`/api/jobs/${en.id}/close`,{method:"POST",headers:{"Content-Type":"application/json"}});if(401===t.status){ed(!1),er(null),e.push("/login");return}let s=await t.json().catch(()=>null);if(!t.ok||!s?.ok)throw Error(s?.error??"à¸›à¸´à¸”à¸‡à¸²à¸™à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ");ex({message:"âœ… à¸›à¸´à¸”à¸‡à¸²à¸™à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢",tone:"success"}),await e_(),er(null)}catch(t){let e=t instanceof Error?t.message:"à¸›à¸´à¸”à¸‡à¸²à¸™à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ";eu(e),ex({message:e,tone:"error"})}finally{ed(!1)}},ew=async()=>{await j.O.auth.signOut(),await fetch("/api/auth/session",{method:"DELETE"}),e.push("/login")},ek=async()=>{if(!q)return;let e={};if(A||(e.date="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸ˆà¹‰à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸™à¸„à¸£"),F.trim()||(e.memoNo="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸"),Object.keys(e).length>0){Y(e);return}H(!0),Y({});let{error:t}=await (0,g.Z6)(q.id,{date:A,memoNo:F.trim()});if(t){Y({submit:t.message||"à¸šà¸±à¸™à¸—à¸¶à¸à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ"}),H(!1);return}s(e=>e.map(e=>e.id===q.id?{...e,nakhon_status:"NOTIFIED",nakhon_notified_date:A,nakhon_memo_no:F.trim()}:e)),eb()},eS=async e=>{I(null),U(t=>({...t,[e.id]:!0}));let{error:t}=await (0,g.uA)(e.id);if(t){I(t.message||"à¸­à¸±à¸›à¹€à¸”à¸•à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ"),U(t=>({...t,[e.id]:!1}));return}s(t=>t.map(t=>t.id===e.id?{...t,nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}:t)),U(t=>({...t,[e.id]:!1}))},eE=async()=>{if(!B)return;let e={};if(ee.doc_issue_date||(e.doc_issue_date="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸­à¸­à¸à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­"),ee.doc_purpose.trim()||(e.doc_purpose="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ"),ee.doc_area_title.trim()||(e.doc_area_title="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸šà¸£à¸´à¹€à¸§à¸“à¸—à¸µà¹ˆà¸”à¸±à¸š"),ee.doc_time_start.trim()||(e.doc_time_start="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡à¸”à¸±à¸šà¹„à¸Ÿ"),ee.doc_time_end.trim()||(e.doc_time_end="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¹€à¸§à¸¥à¸²à¸ˆà¹ˆà¸²à¸¢à¹„à¸Ÿ"),ee.doc_area_detail.trim()||(e.doc_area_detail="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¸”à¸±à¸šà¹„à¸Ÿ"),ee.map_link.trim()||(e.map_link="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸¥à¸´à¹‰à¸‡ google map"),Object.keys(e).length>0){ea(e);return}let t={doc_issue_date:ee.doc_issue_date,doc_purpose:ee.doc_purpose.trim(),doc_area_title:ee.doc_area_title.trim(),doc_time_start:ee.doc_time_start.trim(),doc_time_end:ee.doc_time_end.trim(),doc_area_detail:ee.doc_area_detail.trim(),map_link:ee.map_link.trim()};eo(!0),ea({});try{let e=await fetch("/api/docs/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:B.id,payload:t})});if(!e.ok){let t=e.headers.get("Content-Type")??"",s="";if(t.includes("application/json")){let t=await e.json().catch(()=>null);s=t?.error||t?.message||""}else s=await e.text().catch(()=>"");ea({submit:s?`à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸à¸ªà¸²à¸£à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ (${s})`:"à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸à¸ªà¸²à¸£à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ"}),eo(!1);return}let a=await e.blob(),l=window.URL.createObjectURL(a),o=N(e.headers.get("Content-Disposition"))??`outage-doc-${B.id}.docx`,n=document.createElement("a");n.href=l,n.download=o,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(l);let r=new Date().toISOString();s(e=>e.map(e=>e.id===B.id?{...e,...t,doc_status:"GENERATED",doc_url:null,doc_generated_at:r}:e));try{let e=await fetch("/api/jobs/social-pending",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jobId:B.id})}),t=await e.json().catch(()=>null);e.ok&&t?.ok?s(e=>e.map(e=>e.id===B.id?{...e,social_status:"PENDING_APPROVAL"}:e)):console.warn("Failed to set social pending status",t)}catch(e){console.warn("Failed to set social pending status",e)}ef()}catch(e){console.error(e),ea({submit:"à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸à¸ªà¸²à¸£à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ"}),eo(!1)}},eC=(0,n.useMemo)(()=>{let e=C.trim().toLowerCase();return t.filter(e=>"closed"===$?e.is_closed:!e.is_closed).filter(t=>!e||t.equipment_code.toLowerCase().includes(e)).filter(e=>"all"===O||x(e).color.toLowerCase()===O).sort((e,t)=>{if("closed"===$){let s=e.closed_at?new Date(e.closed_at).getTime():0;return(t.closed_at?new Date(t.closed_at).getTime():0)-s}return u(e.outage_date).getTime()-u(t.outage_date).getTime()})},[t,C,O,$]);return a.jsx("div",{className:b.We,children:(0,a.jsxs)("div",{className:"mx-auto flex w-full max-w-5xl flex-col gap-6 px-4 py-8 sm:px-6 lg:px-8",children:[(0,a.jsxs)("header",{className:"flex flex-col gap-5 rounded-2xl border border-slate-200/60 bg-white/80 p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-900",children:"Krabi Outage Tracker"}),a.jsx("p",{className:"text-sm text-slate-500",children:"à¸•à¸´à¸”à¸•à¸²à¸¡à¸‡à¸²à¸™à¸”à¸±à¸šà¹„à¸Ÿà¸•à¸²à¸¡à¸à¸³à¸«à¸™à¸”à¹à¸¥à¸°à¸ªà¸–à¸²à¸™à¸°à¸§à¸±à¸™à¸„à¸‡à¹€à¸«à¸¥à¸·à¸­"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-start gap-3 sm:items-end",children:[ep?a.jsx("span",{className:"text-xs font-medium text-slate-500",children:ep}):null,(0,a.jsxs)("div",{className:"flex flex-wrap gap-2",children:[a.jsx(l.default,{href:"/new",className:b.MY,children:"+ à¸ªà¸£à¹‰à¸²à¸‡à¸‡à¸²à¸™"}),a.jsx("button",{type:"button",onClick:ew,className:b.SK,children:"à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-end lg:justify-between",children:[(0,a.jsxs)("div",{className:"flex w-full max-w-md flex-col gap-2",children:[a.jsx("label",{className:"text-sm font-medium text-slate-600",children:"à¸„à¹‰à¸™à¸«à¸²à¸­à¸¸à¸›à¸à¸£à¸“à¹Œ"}),a.jsx("input",{value:C,onChange:e=>D(e.target.value),placeholder:"à¸à¸£à¸­à¸à¸£à¸«à¸±à¸ªà¸­à¸¸à¸›à¸à¸£à¸“à¹Œ",className:b.cX})]}),a.jsx(c,{options:[{id:"all",label:"à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”"},{id:"green",label:"à¹€à¸‚à¸µà¸¢à¸§"},{id:"yellow",label:"à¹€à¸«à¸¥à¸·à¸­à¸‡"},{id:"red",label:"à¹à¸”à¸‡"}],value:O,onChange:T})]}),a.jsx(c,{options:[{id:"active",label:"à¸à¸³à¸¥à¸±à¸‡à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£"},{id:"closed",label:"à¸›à¸´à¸”à¹à¸¥à¹‰à¸§"}],value:$,onChange:P})]}),em?a.jsx("div",{className:`rounded-xl border px-4 py-3 text-sm ${"success"===em.tone?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-rose-200 bg-rose-50 text-rose-700"}`,children:em.message}):null,h?a.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700",children:h}):null,L?a.jsx("div",{className:"rounded-xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-700",children:L}):null,a.jsx("section",{className:"grid gap-4",children:m?a.jsx("div",{className:`${b.pU} px-4 py-8 text-center text-sm text-slate-500`,children:"à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥..."}):0===eC.length?a.jsx("div",{className:`${b.pU} px-4 py-8 text-center text-sm text-slate-500`,children:"à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‡à¸²à¸™à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸à¸±à¸šà¸•à¸±à¸§à¸à¸£à¸­à¸‡"}):eC.map(e=>{var t;let s=x(e),o="RED"===(t=s.color)?{strip:"bg-rose-200/80",badge:"border border-rose-200/80 bg-rose-50 text-rose-700",text:"text-rose-700"}:"YELLOW"===t?{strip:"bg-amber-200/80",badge:"border border-amber-200/80 bg-amber-50 text-amber-700",text:"text-amber-700"}:{strip:"bg-emerald-200/80",badge:"border border-emerald-200/80 bg-emerald-50 text-emerald-700",text:"text-emerald-700"},n=e.nakhon_status??"PENDING",i="NOTIFIED"===n,d=R[e.id]??!1,c=e.is_closed??!1,m="GENERATED"===e.doc_status||!!e.doc_generated_at,p="GENERATING"===e.doc_status,h=e.social_status??"DRAFT",_=e.notice_status??"NONE",g=y(e),j=v[g],N=e=>e===g?k:S;return(0,a.jsxs)("div",{className:`${b.pU} group flex items-stretch overflow-hidden transition hover:-translate-y-0.5`,children:[a.jsx("div",{className:`w-2 ${o.strip}`}),(0,a.jsxs)("div",{className:"flex w-full flex-col gap-4 p-5 sm:flex-row sm:items-start sm:justify-between",children:[(0,a.jsxs)(l.default,{href:`/job/${e.id}`,className:"flex min-w-[240px] flex-1 flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{className:"text-sm text-slate-500",children:u(e.outage_date).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})}),a.jsx("span",{className:`text-sm font-medium ${o.text}`,children:s.label})]}),a.jsx(f,{status:s.color,label:s.color})]}),c?(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs font-medium text-slate-600",children:[a.jsx("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-700",children:"à¸›à¸´à¸”à¹à¸¥à¹‰à¸§"}),(0,a.jsxs)("span",{children:["à¸›à¸´à¸”à¹€à¸¡à¸·à¹ˆà¸­"," ",e.closed_at?new Date(e.closed_at).toLocaleString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-"]})]}):null,(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-lg font-semibold tracking-tight text-slate-900",children:e.equipment_code}),a.jsx("p",{className:"text-sm text-slate-600",children:e.note?.trim()||"à¹„à¸¡à¹ˆà¸¡à¸µà¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸"})]}),(0,a.jsxs)("div",{className:"grid gap-3 text-xs text-slate-500 sm:grid-cols-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{children:"à¸¥à¸´à¹‰à¸‡ Google Map"}),a.jsx(r.Z,{url:e.map_link??void 0,label:"à¹€à¸›à¸´à¸” Google Map"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx("span",{children:"à¸¥à¸´à¹‰à¸‡ My Map"}),a.jsx(r.Z,{url:e.mymaps_url??void 0})]})]}),(i||"NOT_REQUIRED"===n)&&a.jsx("div",{className:"text-sm text-slate-600",children:i?(0,a.jsxs)(a.Fragment,{children:["à¹à¸ˆà¹‰à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸™à¸„à¸£à¹à¸¥à¹‰à¸§:"," ",a.jsx("span",{className:"font-medium text-slate-800",children:e.nakhon_notified_date?u(e.nakhon_notified_date).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"}):"-"})," ","| à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸:"," ",a.jsx("span",{className:"font-medium text-slate-800",children:e.nakhon_memo_no??"-"})]}):a.jsx("span",{children:"à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹à¸ˆà¹‰à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸™à¸„à¸£"})})]}),c?null:(0,a.jsxs)("div",{className:"flex w-full flex-col items-stretch gap-2 sm:w-auto sm:min-w-[220px]",children:[(0,a.jsxs)("div",{className:"text-xs font-medium text-slate-500",children:["à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸–à¸±à¸”à¹„à¸›:"," ",a.jsx("span",{className:"text-slate-700",children:j})]}),"PENDING"===n?(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:()=>ej(e),className:N("notify_nakhon"),children:"à¹à¸ˆà¹‰à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸™à¸„à¸£à¹à¸¥à¹‰à¸§"}),a.jsx("button",{type:"button",onClick:()=>eS(e),disabled:d,className:`${S} ${E}`,children:d?"à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...":"à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¹à¸ˆà¹‰à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸™à¸„à¸£"})]}):a.jsx(a.Fragment,{children:m?e.doc_url?a.jsx("button",{type:"button",onClick:()=>{if(e.doc_url){window.open(e.doc_url,"_blank","noopener,noreferrer");return}eN(e)},className:N("create_doc"),children:"à¸žà¸´à¸¡à¸žà¹Œà¹€à¸­à¸à¸ªà¸²à¸£"}):a.jsx("button",{type:"button",onClick:()=>eN(e),className:S,children:"à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹€à¸­à¸à¸ªà¸²à¸£à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡"}):a.jsx("button",{type:"button",onClick:()=>eN(e),disabled:d||p,className:`${N("create_doc")} ${E}`,children:p?"à¸à¸³à¸¥à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡...":"à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸à¸ªà¸²à¸£à¸”à¸±à¸šà¹„à¸Ÿ"})}),"PENDING_APPROVAL"===h||"POSTED"===h?a.jsx("button",{type:"button",onClick:()=>Q(e),className:N("wait_approval"),children:"POSTED"===h?"Posted à¹à¸¥à¹‰à¸§à¸ªà¸·à¹ˆà¸­ Social":"à¸£à¸­à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´"}):null,"POSTED"===h?a.jsx("button",{type:"button",onClick:()=>z(e),className:N("notify_outage_letter"),children:"SCHEDULED"===_?"à¸à¸³à¸«à¸™à¸”à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§ (à¹à¸à¹‰à¹„à¸‚à¹„à¸”à¹‰)":"à¹à¸ˆà¹‰à¸‡à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸”à¸±à¸šà¹„à¸Ÿ"}):null,"SCHEDULED"!==_||c?null:a.jsx("button",{type:"button",onClick:()=>ey(e),className:N("close_job"),children:"à¸›à¸´à¸”à¸‡à¸²à¸™"})]})]})]},e.id)})}),a.jsx(i.Z,{isOpen:!!q,title:"à¹à¸ˆà¹‰à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸™à¸„à¸£à¹à¸¥à¹‰à¸§",onClose:eb,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸§à¸±à¸™à¸—à¸µà¹ˆà¹à¸ˆà¹‰à¸‡à¸¨à¸¹à¸™à¸¢à¹Œà¸™à¸„à¸£",a.jsx("input",{type:"date",value:A,onChange:e=>M(e.target.value),className:b.cX,required:!0}),Z.date?a.jsx("span",{className:"text-xs text-red-600",children:Z.date}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¹€à¸¥à¸‚à¸—à¸µà¹ˆà¸šà¸±à¸™à¸—à¸¶à¸",a.jsx("input",{type:"text",value:F,onChange:e=>X(e.target.value),className:b.cX,required:!0}),Z.memoNo?a.jsx("span",{className:"text-xs text-red-600",children:Z.memoNo}):null]}),Z.submit?a.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:Z.submit}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:eb,className:b.SK,children:"à¸¢à¸à¹€à¸¥à¸´à¸"}),a.jsx("button",{type:"button",onClick:ek,disabled:K,className:`${b.MY} disabled:cursor-not-allowed disabled:opacity-70`,children:K?"à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...":"à¸•à¸à¸¥à¸‡"})]})]})}),a.jsx(i.Z,{isOpen:!!B,title:"à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸­à¸à¸ªà¸²à¸£à¸”à¸±à¸šà¹„à¸Ÿ",onClose:ef,children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸¥à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ",a.jsx("input",{type:"date",value:ee.doc_issue_date,onChange:e=>et(t=>({...t,doc_issue_date:e.target.value})),className:b.cX,required:!0}),es.doc_issue_date?a.jsx("span",{className:"text-xs text-red-600",children:es.doc_issue_date}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸”à¸±à¸šà¹„à¸Ÿà¹€à¸žà¸·à¹ˆà¸­",a.jsx("input",{type:"text",value:ee.doc_purpose,onChange:e=>et(t=>({...t,doc_purpose:e.target.value})),className:b.cX,required:!0}),es.doc_purpose?a.jsx("span",{className:"text-xs text-red-600",children:es.doc_purpose}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸šà¸£à¸´à¹€à¸§à¸“à¸—à¸µà¹ˆà¸”à¸±à¸š",a.jsx("input",{type:"text",value:ee.doc_area_title,onChange:e=>et(t=>({...t,doc_area_title:e.target.value})),className:b.cX,required:!0}),es.doc_area_title?a.jsx("span",{className:"text-xs text-red-600",children:es.doc_area_title}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡à¸”à¸±à¸šà¹„à¸Ÿ",a.jsx("input",{type:"time",value:ee.doc_time_start,onChange:e=>et(t=>({...t,doc_time_start:e.target.value})),className:b.cX,required:!0}),es.doc_time_start?a.jsx("span",{className:"text-xs text-red-600",children:es.doc_time_start}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¹€à¸§à¸¥à¸²à¸ˆà¹ˆà¸²à¸¢à¹„à¸Ÿ",a.jsx("input",{type:"time",value:ee.doc_time_end,onChange:e=>et(t=>({...t,doc_time_end:e.target.value})),className:b.cX,required:!0}),es.doc_time_end?a.jsx("span",{className:"text-xs text-red-600",children:es.doc_time_end}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¸”à¸±à¸šà¹„à¸Ÿ",a.jsx("textarea",{value:ee.doc_area_detail,onChange:e=>et(t=>({...t,doc_area_detail:e.target.value})),rows:3,className:b.cX,required:!0}),es.doc_area_detail?a.jsx("span",{className:"text-xs text-red-600",children:es.doc_area_detail}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸¥à¸´à¹‰à¸‡ google map",a.jsx("input",{type:"url",value:ee.map_link,onChange:e=>et(t=>({...t,map_link:e.target.value})),className:b.cX,required:!0}),es.map_link?a.jsx("span",{className:"text-xs text-red-600",children:es.map_link}):null]}),es.submit?a.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:es.submit}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:ef,className:b.SK,children:"à¸¢à¸à¹€à¸¥à¸´à¸"}),a.jsx("button",{type:"button",onClick:eE,disabled:el,className:`${b.MY} disabled:cursor-not-allowed disabled:opacity-70`,children:el?"à¸à¸³à¸¥à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡...":"à¸ªà¸£à¹‰à¸²à¸‡"})]})]})}),a.jsx(_,{job:W,isOpen:!!W,onClose:()=>{Q(null)},onJobUpdate:(e,t)=>{s(s=>s.map(s=>s.id===e?{...s,...t}:s)),Q(s=>s?.id===e?{...s,...t}:s)}}),a.jsx(d.Z,{job:V,open:!!V,onOpenChange:e=>{e||eg()},onJobUpdate:(e,t)=>{s(s=>s.map(s=>s.id===e?{...s,...t}:s)),z(s=>s?.id===e?{...s,...t}:s)}}),a.jsx(i.Z,{isOpen:!!en,title:"à¸¢à¸·à¸™à¸¢à¸±à¸™à¸›à¸´à¸”à¸‡à¸²à¸™?",onClose:()=>er(null),children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[a.jsx("p",{className:"text-sm text-slate-600",children:'à¸›à¸´à¸”à¸‡à¸²à¸™à¹à¸¥à¹‰à¸§à¸ˆà¸°à¸–à¸¹à¸à¸¢à¹‰à¸²à¸¢à¹„à¸›à¸—à¸µà¹ˆ "à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸›à¸´à¸”à¹à¸¥à¹‰à¸§" à¹à¸¥à¸°à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹à¸à¹‰à¹„à¸‚à¹„à¸”à¹‰'}),ec?a.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:ec}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:()=>er(null),className:b.SK,children:"à¸¢à¸à¹€à¸¥à¸´à¸"}),a.jsx("button",{type:"button",onClick:ev,disabled:ei,className:`${b.MY} disabled:cursor-not-allowed disabled:opacity-70`,children:ei?"à¸à¸³à¸¥à¸±à¸‡à¸›à¸´à¸”à¸‡à¸²à¸™...":"à¸¢à¸·à¸™à¸¢à¸±à¸™à¸›à¸´à¸”à¸‡à¸²à¸™"})]})]})})]})})}},8168:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var a=s(326),l=s(3217);let o=e=>{let t=e?.trim();if(!t)return{status:"empty"};let s=/^https?:\/\//i.test(t)?t:`https://${t}`;try{let e=new URL(s);if("http:"!==e.protocol&&"https:"!==e.protocol)return{status:"invalid"};return{status:"valid",url:e.toString()}}catch{return{status:"invalid"}}};function n({url:e,label:t="à¹€à¸›à¸´à¸” My Map",className:s=""}){let n=o(e),r=s?` ${s}`:"";if("valid"===n.status)return a.jsx("a",{href:n.url,target:"_blank",rel:"noopener noreferrer",className:`inline-flex items-center ${l.hV}${r}`,children:t});let i="empty"===n.status?"à¹„à¸¡à¹ˆà¸¡à¸µà¸¥à¸´à¸‡à¸à¹Œà¹à¸œà¸™à¸—à¸µà¹ˆ":"à¸¥à¸´à¸‡à¸à¹Œà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡";return a.jsx("span",{className:`text-sm text-slate-400${r}`,children:i})}},7687:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(326);function l({isOpen:e,title:t,onClose:s,children:l}){return e?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4",children:[a.jsx("div",{className:"absolute inset-0 bg-slate-900/40",onClick:s,role:"presentation"}),(0,a.jsxs)("div",{className:"relative z-10 w-full max-w-lg rounded-xl bg-white p-6 shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[t?a.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:t}):null,a.jsx("button",{type:"button",onClick:s,className:"text-sm text-slate-500 hover:text-slate-700",children:"à¸›à¸´à¸”"})]}),a.jsx("div",{className:"mt-4",children:l})]})]}):null}},9068:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});var a=s(326),l=s(7577),o=s(7687);function n({open:e,onOpenChange:t,job:s,onJobUpdate:n}){let[r,i]=(0,l.useState)(""),[d,c]=(0,l.useState)(""),[u,m]=(0,l.useState)(""),[x,p]=(0,l.useState)({}),[h,_]=(0,l.useState)(!1),[b,f]=(0,l.useState)(null),g=async()=>{if(!s)return;let e={},a=u.trim();if(r||(e.noticeDate="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸°à¹„à¸›à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡"),d.trim()||(e.noticeBy="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸œà¸¹à¹‰à¹à¸ˆà¹‰à¸‡"),a){let t=/^https?:\/\//i.test(a)?a:`https://${a}`;try{let e=new URL(t);if("http:"!==e.protocol&&"https:"!==e.protocol)throw Error("invalid protocol")}catch{e.mymapsUrl="à¸¥à¸´à¹‰à¸‡à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡"}}else e.mymapsUrl="à¸à¸£à¸¸à¸“à¸²à¸£à¸°à¸šà¸¸à¸¥à¸´à¹‰à¸‡ my map";if(Object.keys(e).length>0){p(e);return}_(!0),p({});try{let e=/^https?:\/\//i.test(a)?a:`https://${a}`,l={jobId:s.id,notice_date:r,notice_by:d.trim(),mymaps_url:e},o=await fetch("/api/jobs/notice-schedule",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}),i=await o.json().catch(()=>null);if(!o.ok||!i?.ok)throw Error(i?.error??"à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸³à¸«à¸™à¸”à¸à¸²à¸£à¹„à¸”à¹‰");let c=i.notice_scheduled_at??new Date().toISOString();n?.(s.id,{notice_status:"SCHEDULED",notice_date:l.notice_date,notice_by:l.notice_by,mymaps_url:l.mymaps_url,notice_scheduled_at:c}),f("à¸à¸³à¸«à¸™à¸”à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢à¹à¸¥à¹‰à¸§"),setTimeout(()=>{t(!1)},800)}catch(e){console.error("Notice schedule failed",e),p({submit:"à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸³à¸«à¸™à¸”à¸à¸²à¸£à¹„à¸¡à¹ˆà¸ªà¸³à¹€à¸£à¹‡à¸ˆ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ"})}finally{_(!1)}};return a.jsx(o.Z,{isOpen:e,title:"à¹à¸ˆà¹‰à¸‡à¸«à¸™à¸±à¸‡à¸ªà¸·à¸­à¸”à¸±à¸šà¹„à¸Ÿ",onClose:()=>t(!1),children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[b?a.jsx("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700",children:b}):null,(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ˆà¸°à¹„à¸›à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¹à¸ˆà¹‰à¸‡",a.jsx("input",{type:"date",value:r,onChange:e=>i(e.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0}),x.noticeDate?a.jsx("span",{className:"text-xs text-red-600",children:x.noticeDate}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸œà¸¹à¹‰à¹à¸ˆà¹‰à¸‡",a.jsx("input",{type:"text",value:d,onChange:e=>c(e.target.value),className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0}),x.noticeBy?a.jsx("span",{className:"text-xs text-red-600",children:x.noticeBy}):null]}),(0,a.jsxs)("label",{className:"flex flex-col gap-2 text-sm font-medium text-slate-700",children:["à¸¥à¸´à¹‰à¸‡ my map",a.jsx("input",{type:"url",value:u,onChange:e=>m(e.target.value),placeholder:"https://",className:"rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm outline-none focus:border-slate-400",required:!0}),x.mymapsUrl?a.jsx("span",{className:"text-xs text-red-600",children:x.mymapsUrl}):null]}),x.submit?a.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:x.submit}):null,(0,a.jsxs)("div",{className:"flex flex-wrap justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:()=>t(!1),className:"rounded-xl border border-slate-200 px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100",children:"à¸¢à¸à¹€à¸¥à¸´à¸"}),a.jsx("button",{type:"button",onClick:g,disabled:h,className:"rounded-xl bg-slate-900 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-slate-800 disabled:cursor-not-allowed disabled:opacity-70",children:h?"à¸à¸³à¸¥à¸±à¸‡à¸šà¸±à¸™à¸—à¸¶à¸...":"à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸³à¸«à¸™à¸”à¸à¸²à¸£"})]})]})})}},8927:(e,t,s)=>{"use strict";s.d(t,{Cq:()=>o,DQ:()=>l,Z6:()=>r,gK:()=>n,uA:()=>i});var a=s(1632);async function l(){return a.O.from("outage_jobs").select("*").order("outage_date",{ascending:!0})}async function o(e){return a.O.from("outage_jobs").insert({outage_date:e.outage_date,equipment_code:e.equipment_code,note:e.note??null})}async function n(e,t){return a.O.from("outage_jobs").update({outage_date:t.outage_date,equipment_code:t.equipment_code,note:t.note??null}).eq("id",e)}async function r(e,t){return a.O.from("outage_jobs").update({nakhon_status:"NOTIFIED",nakhon_notified_date:t.date,nakhon_memo_no:t.memoNo}).eq("id",e)}async function i(e){return a.O.from("outage_jobs").update({nakhon_status:"NOT_REQUIRED",nakhon_notified_date:null,nakhon_memo_no:null}).eq("id",e)}},1632:(e,t,s)=>{"use strict";s.d(t,{O:()=>a});let a=(0,s(9701).e)()},9701:(e,t,s)=>{"use strict";s.d(t,{X:()=>c,e:()=>d});var a=s(5157);let l="https://yhkrzepnokhiqbxwhkgz.supabase.co",o="sb_publishable_CdTtNwP3k39LxhkLkKbS3w_Y3co_tFE",n=null,r=()=>{if(!l||!o)throw Error("Missing Supabase env vars. Set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY.")},i=async(e,t)=>{},d=()=>(r(),n||(n=(0,a.eI)(l,o)),n),c=async e=>{await i(e.access_token,e.refresh_token)}},3217:(e,t,s)=>{"use strict";s.d(t,{MY:()=>n,SK:()=>r,We:()=>a,cS:()=>c,cX:()=>i,hV:()=>d,pU:()=>l,uI:()=>o});let a="min-h-screen bg-slate-50",l="rounded-2xl border border-slate-200/60 bg-white/80 shadow-sm transition hover:shadow-md",o="bg-violet-600 text-white hover:bg-violet-700 focus-visible:ring-violet-300",n=`inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 ${o}`,r="inline-flex items-center justify-center rounded-xl border border-slate-200 bg-slate-100/60 px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-100 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-violet-300 focus-visible:ring-offset-2",i="rounded-xl border border-slate-200/80 bg-white px-3 py-2 text-sm text-slate-700 shadow-sm outline-none transition focus:border-violet-500 focus-visible:ring-2 focus-visible:ring-violet-200",d="text-sm font-medium text-violet-600 underline-offset-4 transition hover:text-violet-700 hover:underline",c=e=>{switch(e){case"RED":return"border border-rose-200/80 bg-rose-50 text-rose-700";case"YELLOW":return"border border-amber-200/80 bg-amber-50 text-amber-700";default:return"border border-emerald-200/80 bg-emerald-50 text-emerald-700"}}},2029:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o,metadata:()=>l});var a=s(9510);s(5023);let l={title:"Krabi Outage Tracker",description:"Track planned outages in Krabi."};function o({children:e}){return a.jsx("html",{lang:"th",children:a.jsx("body",{children:a.jsx("div",{className:"min-h-screen",children:a.jsx("main",{className:"mx-auto flex w-full max-w-5xl flex-col px-4 py-8",children:e})})})})}},5023:()=>{}};