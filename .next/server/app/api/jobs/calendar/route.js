"use strict";(()=>{var e={};e.id=606,e.ids=[606],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7107:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{GET:()=>g,runtime:()=>l});var o=r(9303),a=r(8716),n=r(670),u=r(7070),i=r(7857);let l="nodejs",d=process.env.SUPABASE_URL??"https://yhkrzepnokhiqbxwhkgz.supabase.co",p=process.env.SUPABASE_SERVICE_ROLE_KEY,c=/^\d{4}-\d{2}-\d{2}$/;function E(e){if(!c.test(e))return!1;let[t,r,s]=e.split("-").map(Number),o=new Date(`${e}T00:00:00`);return!Number.isNaN(o.getTime())&&o.getFullYear()===t&&o.getMonth()+1===r&&o.getDate()===s}async function g(e){try{let{searchParams:t}=new URL(e.url),r=t.get("from")??"",s=t.get("to")??"";if(!r||!s||!E(r)||!E(s))return u.NextResponse.json({ok:!1,error:"Invalid or missing date range"},{status:400});if(r>s)return u.NextResponse.json({ok:!1,error:"from must be before to"},{status:400});let o=function(){if(!d)throw Error("Missing SUPABASE_URL env var.");if(!p)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY env var.");return(0,i.eI)(d,p)}(),{data:a,error:n}=await o.from("outage_jobs").select("outage_date, doc_status, social_status, notice_status, is_closed").gte("outage_date",r).lte("outage_date",s);if(n)throw Error(n.message);let l=new Map;(a??[]).forEach(e=>{let t=e.outage_date;if(!t)return;let r=e.is_closed?"Done":(e.notice_status??"NONE")==="SCHEDULED"?"Notice":(e.social_status??"DRAFT")==="POSTED"?"Posted":["GENERATED","GENERATING"].includes(e.doc_status??"PENDING")?"Doc":"Draft",s=l.get(t)??{date:t,total:0,byStatus:{}};s.total+=1,s.byStatus[r]=(s.byStatus[r]??0)+1,l.set(t,s)});let c=Array.from(l.values()).sort((e,t)=>e.date.localeCompare(t.date));return u.NextResponse.json(c)}catch(e){return console.error("Calendar summary failed",e),u.NextResponse.json({ok:!1,error:"ไม่สามารถโหลดข้อมูลได้ กรุณาลองใหม่"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/jobs/calendar/route",pathname:"/api/jobs/calendar",filename:"route",bundlePath:"app/api/jobs/calendar/route"},resolvedPagePath:"C:\\Users\\506870\\Desktop\\KB-outage\\src\\app\\api\\jobs\\calendar\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:_,serverHooks:h}=m,b="/api/jobs/calendar/route";function v(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:_})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,564],()=>r(7107));module.exports=s})();