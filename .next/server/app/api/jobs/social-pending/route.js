"use strict";(()=>{var e={};e.id=769,e.ids=[769],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8997:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>j,patchFetch:()=>A,requestAsyncStorage:()=>E,routeModule:()=>g,serverHooks:()=>_,staticGenerationAsyncStorage:()=>R});var t={};r.r(t),r.d(t,{POST:()=>l,runtime:()=>p});var o=r(9303),n=r(8716),i=r(670),a=r(7070),u=r(7857);let p="nodejs",c=process.env.SUPABASE_URL??"https://yhkrzepnokhiqbxwhkgz.supabase.co",d=process.env.SUPABASE_SERVICE_ROLE_KEY;async function l(e){try{let s=await e.json();console.info("Social pending request body:",s);let r=s?.jobId;if(!r)return a.NextResponse.json({ok:!1,error:"missing jobId"},{status:400});if(!d)return a.NextResponse.json({ok:!1,error:"Missing SUPABASE_SERVICE_ROLE_KEY env var."},{status:500});let t=function(){if(!c)throw Error("Missing SUPABASE_URL env var.");if(!d)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY env var.");return(0,u.eI)(c,d)}(),{data:o,error:n}=await t.from("outage_jobs").select("id, social_status").eq("id",r).single();if(n||!o)return a.NextResponse.json({ok:!1,error:"ไม่พบข้อมูลงานที่ต้องการ"},{status:404});let i=o.social_status??"DRAFT";if("DRAFT"===i){let{error:e}=await t.from("outage_jobs").update({social_status:"PENDING_APPROVAL"}).eq("id",r);if(e)throw Error(e.message);return a.NextResponse.json({ok:!0,social_status:"PENDING_APPROVAL"})}return a.NextResponse.json({ok:!0,social_status:i})}catch(e){return console.error("Social pending failed",e),a.NextResponse.json({ok:!1,error:"ไม่สามารถอัปเดตสถานะได้ กรุณาลองใหม่"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/jobs/social-pending/route",pathname:"/api/jobs/social-pending",filename:"route",bundlePath:"app/api/jobs/social-pending/route"},resolvedPagePath:"C:\\Users\\506870\\Desktop\\KB-outage\\src\\app\\api\\jobs\\social-pending\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:E,staticGenerationAsyncStorage:R,serverHooks:_}=g,j="/api/jobs/social-pending/route";function A(){return(0,i.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:R})}}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[948,564],()=>r(8997));module.exports=t})();