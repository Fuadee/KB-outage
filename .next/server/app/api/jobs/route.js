"use strict";(()=>{var e={};e.id=204,e.ids=[204],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6855:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>R,requestAsyncStorage:()=>m,routeModule:()=>E,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{GET:()=>_,runtime:()=>d});var o=r(9303),a=r(8716),i=r(670),n=r(7070),u=r(7857);let d="nodejs",c=process.env.SUPABASE_URL??"https://yhkrzepnokhiqbxwhkgz.supabase.co",l=process.env.SUPABASE_SERVICE_ROLE_KEY,p=/^\d{4}-\d{2}-\d{2}$/;async function _(e){try{let{searchParams:t}=new URL(e.url),r=t.get("date")??"";if(!r||!function(e){if(!p.test(e))return!1;let[t,r,s]=e.split("-").map(Number),o=new Date(`${e}T00:00:00`);return!Number.isNaN(o.getTime())&&o.getFullYear()===t&&o.getMonth()+1===r&&o.getDate()===s}(r))return n.NextResponse.json({ok:!1,error:"Invalid or missing date"},{status:400});let s=function(){if(!c)throw Error("Missing SUPABASE_URL env var.");if(!l)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY env var.");return(0,u.eI)(c,l)}(),{data:o,error:a}=await s.from("outage_jobs").select("id, outage_date, doc_time_start, doc_time_end, doc_area_title, doc_status, social_status, notice_status, is_closed, created_at").eq("outage_date",r).order("doc_time_start",{ascending:!0,nullsFirst:!0}).order("created_at",{ascending:!0});if(a)throw Error(a.message);let i=(o??[]).map(e=>({id:e.id,outage_date:e.outage_date,time_start:e.doc_time_start??null,time_end:e.doc_time_end??null,area_title:e.doc_area_title??null,status:e.is_closed?"Done":(e.notice_status??"NONE")==="SCHEDULED"?"Notice":(e.social_status??"DRAFT")==="POSTED"?"Posted":["GENERATED","GENERATING"].includes(e.doc_status??"PENDING")?"Doc":"Draft"}));return n.NextResponse.json(i)}catch(e){return console.error("Jobs by date failed",e),n.NextResponse.json({ok:!1,error:"ไม่สามารถโหลดข้อมูลได้ กรุณาลองใหม่"},{status:500})}}let E=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/jobs/route",pathname:"/api/jobs",filename:"route",bundlePath:"app/api/jobs/route"},resolvedPagePath:"C:\\Users\\506870\\Desktop\\KB-outage\\src\\app\\api\\jobs\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:h}=E,v="/api/jobs/route";function R(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,564],()=>r(6855));module.exports=s})();