"use strict";(()=>{var t={};t.id=711,t.ids=[711],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3207:(t,e,o)=>{o.r(e),o.d(e,{originalPathname:()=>h,patchFetch:()=>j,requestAsyncStorage:()=>E,routeModule:()=>x,serverHooks:()=>S,staticGenerationAsyncStorage:()=>g});var s={};o.r(s),o.d(s,{POST:()=>m,runtime:()=>l});var a=o(9303),_=o(8716),i=o(670),r=o(7070),c=o(7857);let n=["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸žà¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸žà¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸Žà¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸žà¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"];function p(t){let e=t.doc_purpose??"",o=t.doc_area_title??"",s=t.doc_time_start??"",a=t.doc_time_end??"",_=t.doc_area_detail??"",i=t.map_link??"",r=function(t){if(!t)return"";let e=new Date(`${t}T00:00:00`),o=e.getDate(),s=n[e.getMonth()]??"",a=e.getFullYear()+543;return`${o} ${s} ${a}`.trim()}(t.outage_date);return`à¹€à¸žà¸·à¹ˆà¸­${e} à¸šà¸£à¸´à¹€à¸§à¸“ ${o}
ðŸ“…${r}
â˜£ï¸à¹‚à¸‹à¸™à¸ªà¸µà¹€à¸«à¸¥à¸·à¸­à¸‡ à¹à¸ªà¸”à¸‡à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¹„à¸Ÿà¸”à¸±à¸š à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¹€à¸§à¸¥à¸² ${s} .- ${a} à¸™.
ðŸŒà¸šà¸£à¸´à¹€à¸§à¸“à¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹„à¸Ÿà¹„à¸”à¹‰à¸£à¸±à¸šà¸œà¸¥à¸à¸£à¸°à¸—à¸š ${_}
ðŸ“Œà¸à¸”à¸¥à¸´à¹‰à¸‡à¸„à¹Œ ðŸ‘‡ à¹€à¸žà¸·à¹ˆà¸­à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸žà¸·à¹‰à¸™à¸—à¸µà¹ˆà¹„à¸Ÿà¸”à¸±à¸š ${i}`}let l="nodejs",d=process.env.SUPABASE_URL??"https://yhkrzepnokhiqbxwhkgz.supabase.co",u=process.env.SUPABASE_SERVICE_ROLE_KEY;async function m(t){try{var e;let o=await t.json(),s=o?.jobId;if(!s)return r.NextResponse.json({ok:!1,error:"missing jobId"},{status:400});if(!u)return r.NextResponse.json({ok:!1,error:"Missing SUPABASE_SERVICE_ROLE_KEY env var."},{status:500});let a=function(){if(!d)throw Error("Missing SUPABASE_URL env var.");if(!u)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY env var.");return(0,c.eI)(d,u)}(),{data:_,error:i}=await a.from("outage_jobs").select("id, outage_date, doc_purpose, doc_area_title, doc_time_start, doc_time_end, doc_area_detail, map_link, social_status, social_post_text, social_posted_at, notice_status, notice_date, notice_by, mymaps_url, notice_scheduled_at").eq("id",s).single();if(i||!_)return r.NextResponse.json({ok:!1,error:"à¹„à¸¡à¹ˆà¸žà¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£"},{status:404});let n=(e={outage_date:_.outage_date,doc_purpose:_.doc_purpose,doc_area_title:_.doc_area_title,doc_time_start:_.doc_time_start,doc_time_end:_.doc_time_end,doc_area_detail:_.doc_area_detail,map_link:_.map_link,social_post_text:_.social_post_text},e.social_post_text?.trim()?e.social_post_text:p(e));if("POSTED"===_.social_status&&_.social_post_text)return r.NextResponse.json({ok:!0,preview_text:n,social_status:"POSTED",social_post_text:_.social_post_text,social_posted_at:_.social_posted_at,job:{social_status:"POSTED",social_post_text:_.social_post_text,social_posted_at:_.social_posted_at,notice_status:_.notice_status,notice_date:_.notice_date,notice_by:_.notice_by,mymaps_url:_.mymaps_url,notice_scheduled_at:_.notice_scheduled_at}});let l=_.social_posted_at??new Date().toISOString(),m=n||p(_),{data:x,error:E}=await a.from("outage_jobs").update({social_status:"POSTED",social_post_text:m,social_posted_at:l}).eq("id",s).select("social_status, social_post_text, social_posted_at, notice_status, notice_date, notice_by, mymaps_url, notice_scheduled_at").single();if(E)throw Error(E.message);return r.NextResponse.json({ok:!0,preview_text:m,social_status:x?.social_status??"POSTED",social_post_text:x?.social_post_text??m,social_posted_at:x?.social_posted_at??l,job:x??{social_status:"POSTED",social_post_text:m,social_posted_at:l,notice_status:_.notice_status,notice_date:_.notice_date,notice_by:_.notice_by,mymaps_url:_.mymaps_url,notice_scheduled_at:_.notice_scheduled_at}})}catch(t){return console.error("Social post failed",t),r.NextResponse.json({ok:!1,error:"à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸žà¸ªà¸•à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:_.x.APP_ROUTE,page:"/api/jobs/social-post/route",pathname:"/api/jobs/social-post",filename:"route",bundlePath:"app/api/jobs/social-post/route"},resolvedPagePath:"C:\\Users\\506870\\Desktop\\KB-outage\\src\\app\\api\\jobs\\social-post\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:E,staticGenerationAsyncStorage:g,serverHooks:S}=x,h="/api/jobs/social-post/route";function j(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:g})}}};var e=require("../../../../webpack-runtime.js");e.C(t);var o=t=>e(e.s=t),s=e.X(0,[948,564],()=>o(3207));module.exports=s})();