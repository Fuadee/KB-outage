"use strict";(()=>{var e={};e.id=940,e.ids=[940],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2186:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>S,patchFetch:()=>A,requestAsyncStorage:()=>h,routeModule:()=>E,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{GET:()=>l,runtime:()=>c});var o=s(9303),a=s(8716),n=s(670),i=s(7070),u=s(7857),d=s(5947);let c="nodejs",_=process.env.SUPABASE_URL??"https://yhkrzepnokhiqbxwhkgz.supabase.co",p=process.env.SUPABASE_SERVICE_ROLE_KEY;async function l(){try{let e=function(){if(!_)throw Error("Missing SUPABASE_URL env var.");if(!p)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY env var.");return(0,u.eI)(_,p)}(),{data:t,error:s}=await e.from("outage_jobs").select("id,doc_status,social_status,notice_status,notice_date,nakhon_status,nakhon_notified_date,is_closed");if(s)throw Error(s.message);let r=Array.isArray(t)?t:[],o=r.filter(e=>!e?.is_closed).length,a=r.filter(e=>!!e?.is_closed).length,n=r.filter(e=>{if(e?.is_closed)return!1;let t=(0,d.b)(e);return"ครบแล้ว"!==t&&"ปิดงาน"!==t}).length;return i.NextResponse.json({ok:!0,openCount:o,closedCount:a,actionRequiredCount:n})}catch(e){return console.error("Dashboard summary failed",e),e instanceof Error&&e.message,i.NextResponse.json({ok:!1,error:"ไม่สามารถโหลดข้อมูลได้ กรุณาลองใหม่"},{status:500})}}let E=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/dashboard/summary/route",pathname:"/api/dashboard/summary",filename:"route",bundlePath:"app/api/dashboard/summary/route"},resolvedPagePath:"C:\\Users\\506870\\Desktop\\KB-outage\\src\\app\\api\\dashboard\\summary\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:f}=E,S="/api/dashboard/summary/route";function A(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},5947:(e,t,s)=>{s.d(t,{$:()=>n,b:()=>i});let r="GENERATED",o="POSTED",a="SCHEDULED";function n(e){return e.is_closed?"CLOSED":e.doc_status!==r?"DRAFT":e.social_status!==o?"DOC_READY":e.notice_status!==a&&"SENT"!==e.notice_status?"SOCIAL_POSTED":"NOTICE_SCHEDULED"}function i(e){return e.doc_status!==r?"สร้างเอกสาร":e.social_status!==o?"โพสต์ลง Social":e.notice_status===a||e.notice_date?"NOT_REQUIRED"===e.nakhon_status||e.nakhon_notified_date?e.is_closed?"ครบแล้ว":"ปิดงาน":"แจ้งศูนย์นคร":"ตั้งเวลาแจ้งหนังสือ"}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,564],()=>s(2186));module.exports=r})();