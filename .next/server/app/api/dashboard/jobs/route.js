"use strict";(()=>{var e={};e.id=851,e.ids=[851],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4607:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>S,requestAsyncStorage:()=>b,routeModule:()=>h,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var o={};s.r(o),s.d(o,{GET:()=>E,runtime:()=>c});var a=s(9303),r=s(8716),n=s(670),i=s(7070),d=s(7857),u=s(5947);let c="nodejs",_=process.env.SUPABASE_URL??"https://yhkrzepnokhiqbxwhkgz.supabase.co",l=process.env.SUPABASE_SERVICE_ROLE_KEY,p=["all","open","closed"];async function E(e){try{var t;let{searchParams:s}=new URL(e.url),o=(t=s.get("filter"))&&p.includes(t)?t:"all",a=function(e){let t=e?Number.parseInt(e,10):Number.NaN;return!Number.isFinite(t)||t<=0?50:Math.min(t,200)}(s.get("limit")),r=(function(){if(!_)throw Error("Missing SUPABASE_URL env var.");if(!l)throw Error("Missing SUPABASE_SERVICE_ROLE_KEY env var.");return(0,d.eI)(_,l)})().from("outage_jobs").select("id,outage_date,equipment_code,doc_status,doc_generated_at,doc_url,social_status,social_posted_at,social_approved_at,notice_status,notice_date,notice_scheduled_at,nakhon_status,nakhon_notified_date,is_closed,closed_at,created_at").order("outage_date is null",{ascending:!0}).order("outage_date",{ascending:!1}).order("created_at",{ascending:!1}).limit(a);"closed"===o&&(r=r.eq("is_closed",!0)),"open"===o&&(r=r.or("is_closed.eq.false,is_closed.is.null"));let{data:n,error:c}=await r;if(c)throw Error(c.message);let E=(n??[]).map(e=>{let t=e&&"object"==typeof e?e:{};return{...t,step:(0,u.$)(t),next_action:(0,u.b)(t)}});return i.NextResponse.json({ok:!0,jobs:E})}catch(e){return console.error("Dashboard jobs failed",e),e instanceof Error&&e.message,i.NextResponse.json({ok:!1,error:"ไม่สามารถโหลดข้อมูลได้ กรุณาลองใหม่"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/dashboard/jobs/route",pathname:"/api/dashboard/jobs",filename:"route",bundlePath:"app/api/dashboard/jobs/route"},resolvedPagePath:"C:\\Users\\506870\\Desktop\\KB-outage\\src\\app\\api\\dashboard\\jobs\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:b,staticGenerationAsyncStorage:g,serverHooks:m}=h,f="/api/dashboard/jobs/route";function S(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},5947:(e,t,s)=>{s.d(t,{$:()=>n,b:()=>i});let o="GENERATED",a="POSTED",r="SCHEDULED";function n(e){return e.is_closed?"CLOSED":e.doc_status!==o?"DRAFT":e.social_status!==a?"DOC_READY":e.notice_status!==r&&"SENT"!==e.notice_status?"SOCIAL_POSTED":"NOTICE_SCHEDULED"}function i(e){return e.doc_status!==o?"สร้างเอกสาร":e.social_status!==a?"โพสต์ลง Social":e.notice_status===r||e.notice_date?"NOT_REQUIRED"===e.nakhon_status||e.nakhon_notified_date?e.is_closed?"ครบแล้ว":"ปิดงาน":"แจ้งศูนย์นคร":"ตั้งเวลาแจ้งหนังสือ"}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[948,564],()=>s(4607));module.exports=o})();